[toc]

# ç”¨æˆ·æ¨¡å—

## éœ€æ±‚åˆ†æ

å¯¹äºç”¨æˆ·æ¨¡å—ï¼Œé€šå¸¸è¦å…·æœ‰ä¸‹åˆ—åŠŸèƒ½ï¼š

* ç”¨æˆ·æ³¨å†Œ
* ç”¨æˆ·ç™»å½•
* è·å–å½“å‰ç™»å½•ç”¨æˆ·
* ç”¨æˆ·æ³¨é”€
* ç”¨æˆ·æƒé™æ§åˆ¶
* ã€ç®¡ç†å‘˜ã€‘ç®¡ç†ç”¨æˆ·

å…·ä½“åˆ†ææ¯ä¸ªéœ€æ±‚ï¼š

1. ç”¨æˆ·æ³¨å†Œï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥è´¦å·ã€å¯†ç ã€ç¡®è®¤å¯†ç è¿›è¡Œæ³¨å†Œ
2. ç”¨æˆ·ç™»å½•ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥è´¦å·å’Œå¯†ç ç™»å½•
3. è·å–å½“å‰çš„ç™»å½•ç”¨æˆ·ï¼šå¾—åˆ°å½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸ç”¨é‡å¤ç™»å½•ï¼‰
4. ç”¨æˆ·æ³¨é”€ï¼šç”¨æˆ·å¯ä»¥é€€å‡ºç™»å½•
5. ç”¨æˆ·æƒé™æ§åˆ¶ï¼šç”¨æˆ·åˆåˆ†ä¸ºæ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜æ‹¥æœ‰æ•´ä¸ªç³»ç»Ÿçš„æœ€é«˜æƒé™ï¼Œæ¯”å¦‚å¯ä»¥ç®¡ç†å…¶ä»–ç”¨æˆ·
6. ç”¨æˆ·ç®¡ç†ï¼šä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œå¯ä»¥å¯¹æ•´ä¸ªç³»ç»Ÿä¸­çš„ç”¨æˆ·è¿›è¡Œç®¡ç†ï¼Œæ¯”å¦‚æœç´¢ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·

## æ–¹æ¡ˆè®¾è®¡

å®ç°ç”¨æˆ·æ¨¡å—çš„éš¾åº¦ä¸å¤§ï¼Œæ–¹æ¡ˆè®¾è®¡é˜¶æ®µæˆ‘ä»¬éœ€è¦ç¡®è®¤ï¼š

* åº“è¡¨è®¾è®¡
* ç”¨æˆ·ç™»å½•æµç¨‹
* å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ

## åº“è¡¨è®¾è®¡

### æ ¸å¿ƒè®¾è®¡

```sql
-- ç”¨æˆ·è¡¨
create table if not exists user
(
    id           bigint auto_increment comment 'id' primary key,
    userAccount  varchar(256)                        not null comment 'è´¦å·',
    userPassword varchar(512)                        not null comment 'å¯†ç ',
    userName     varchar(256)                        null comment 'ç”¨æˆ·æ˜µç§°',
    userAvatar   varchar(1024)                       null comment 'ç”¨æˆ·å¤´åƒ',
    userProfile  varchar(512)                        null comment 'ç”¨æˆ·ç®€ä»‹',
    userRole     varchar(256) default 'user'         not null comment 'ç”¨æˆ·è§’è‰²ï¼šuser/admin',
    editTime     datetime     default CURRENT_TIMESTAMP not null comment 'ç¼–è¾‘æ—¶é—´',
    createTime   datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete     tinyint      default 0               not null comment 'æ˜¯å¦åˆ é™¤',
    UNIQUE KEY uk_userAccount (userAccount),
    INDEX idx_userName (userName)
) comment 'ç”¨æˆ·' collate = utf8mb4_unicode_ci;
```

å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š

1. editTime å’Œ updateTime çš„åŒºåˆ«ï¼šeditTime è¡¨ç¤ºç”¨æˆ·ç¼–è¾‘ä¸ªäººä¿¡æ¯çš„æ—¶é—´ï¼ˆéœ€è¦ä¸šåŠ¡ä»£ç æ¥æ›´æ–°ï¼‰ï¼Œè€Œ updateTime è¡¨ç¤ºè¿™æ¡è®°å½•ä»»ä½•å­—æ®µå‘ç”Ÿä¿®æ”¹çš„æ—¶é—´ï¼ˆç”±æ•°æ®åº“è‡ªåŠ¨æ›´æ–°ï¼‰ã€‚
2. ç»™å”¯ä¸€å€¼æ·»åŠ å”¯ä¸€é”®ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ï¼Œæ¯”å¦‚è´¦å· userAccountï¼Œåˆ©ç”¨æ•°æ®åº“å¤©ç„¶é˜²é‡å¤ï¼ŒåŒæ—¶å¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ã€‚
3. ç»™ç»å¸¸ç”¨äºæŸ¥è¯¢çš„å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œæ¯”å¦‚ç”¨æˆ·æ˜µç§° userNameï¼Œå¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ã€‚

å»ºè®®å…»æˆå¥½ä¹ æƒ¯ï¼Œå°†åº“è¡¨è®¾è®¡ SQL ä¿å­˜åˆ°é¡¹ç›®çš„ç›®å½•ä¸­ï¼Œæ¯”å¦‚æ–°å»º sql/create_table.sql æ–‡ä»¶ï¼Œè¿™æ ·å…¶ä»–å¼€å‘è€…å°±èƒ½æ›´å¿«åœ°äº†è§£é¡¹ç›®ã€‚

<img src="https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250728202015139.webp" alt="image-20250728202015139" style="zoom:50%;" />

### æ‰©å±•è®¾è®¡

1ï¼‰å¦‚æœè¦å®ç°ä¼šå‘˜åŠŸèƒ½ï¼Œå¯ä»¥å¯¹è¡¨è¿›è¡Œå¦‚ä¸‹æ‰©å±•ï¼š

1. ç»™ userRole å­—æ®µæ–°å¢æšä¸¾å€¼ vipï¼Œè¡¨ç¤ºä¼šå‘˜ç”¨æˆ·ï¼Œå¯æ ¹æ®è¯¥å€¼åˆ¤æ–­ç”¨æˆ·æƒé™
2. æ–°å¢ä¼šå‘˜è¿‡æœŸæ—¶é—´å­—æ®µï¼Œå¯ç”¨äºè®°å½•ä¼šå‘˜æœ‰æ•ˆæœŸ
3. æ–°å¢ä¼šå‘˜å…‘æ¢ç å­—æ®µï¼Œå¯ç”¨äºè®°å½•ä¼šå‘˜çš„å¼€é€šæ–¹å¼
4. æ–°å¢ä¼šå‘˜ç¼–å·å­—æ®µï¼Œå¯ç”¨äºå®šä½ç”¨æˆ·å¹¶æä¾›é¢å¤–æœåŠ¡ï¼Œå¹¶å¢åŠ ä¼šå‘˜å½’å±æ„Ÿ

å¯¹åº”çš„ SQL å¦‚ä¸‹ï¼š




```SQL
vipExpireTime datetime         null comment 'ä¼šå‘˜è¿‡æœŸæ—¶é—´',
vipCode       varchar(128)     null comment 'ä¼šå‘˜å…‘æ¢ç ',
vipNumber      bigint           null comment 'ä¼šå‘˜ç¼–å·'
```



2ï¼‰å¦‚æœè¦å®ç°ç”¨æˆ·é‚€è¯·åŠŸèƒ½ï¼Œå¯ä»¥å¯¹è¡¨è¿›è¡Œå¦‚ä¸‹æ‰©å±•ï¼š

1. æ–°å¢ shareCode åˆ†äº«ç å­—æ®µï¼Œç”¨äºè®°å½•æ¯ä¸ªç”¨æˆ·çš„å”¯ä¸€é‚€è¯·æ ‡è¯†ï¼Œå¯æ‹¼æ¥åˆ°é‚€è¯·ç½‘å€åé¢ï¼Œæ¯”å¦‚ https://mianshiyuan/shareCode=xxx
2. æ–°å¢ inviteUser å­—æ®µï¼Œç”¨äºè®°å½•è¯¥ç”¨æˆ·è¢«å“ªä¸ªç”¨æˆ·é‚€è¯·äº†ï¼Œå¯é€šè¿‡è¿™ä¸ªå­—æ®µæŸ¥è¯¢æŸç”¨æˆ·é‚€è¯·çš„ç”¨æˆ·åˆ—è¡¨ã€‚

å¯¹åº”çš„ SQL å¦‚ä¸‹ï¼š


```SQL
shareCode     varchar(28) DEFAULT NULL COMMENT 'åˆ†äº«ç ',
inviteUser     bigint          DEFAULT NULL COMMENT 'é‚€è¯·ç”¨æˆ· id'
```



## ç”¨æˆ·ç™»å½•æµç¨‹

1ï¼‰å»ºç«‹åˆå§‹ä¼šè¯ï¼šå‰ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡å™¨ä¼šä¸ºè¯¥å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªåˆå§‹çš„åŒ¿å Sessionï¼Œå¹¶å°†å…¶çŠ¶æ€ä¿å­˜ä¸‹æ¥ã€‚è¿™ä¸ª Session çš„ ID ä¼šä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œè¿”å›ç»™å‰ç«¯ã€‚

2ï¼‰ç™»å½•æˆåŠŸï¼Œæ›´æ–°ä¼šè¯ä¿¡æ¯ï¼šå½“ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥æ­£ç¡®çš„è´¦å·å¯†ç å¹¶æäº¤åˆ°åç«¯éªŒè¯æˆåŠŸåï¼Œåç«¯ä¼šæ›´æ–°è¯¥ç”¨æˆ·çš„ Sessionï¼Œå°†ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ· IDã€ç”¨æˆ·åç­‰ï¼‰ä¿å­˜åˆ°ä¸è¯¥ Session å…³è”çš„å­˜å‚¨ä¸­ã€‚åŒæ—¶ï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ª Set-Cookie çš„å“åº”å¤´ï¼ŒæŒ‡ç¤ºå‰ç«¯ä¿å­˜è¯¥ç”¨æˆ·çš„ Session IDã€‚

3ï¼‰å‰ç«¯ä¿å­˜ Cookieï¼šå‰ç«¯æ¥æ”¶åˆ°åç«¯çš„å“åº”åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ ¹æ® Set-Cookie æŒ‡ä»¤ï¼Œå°† Session ID å­˜å‚¨åˆ°æµè§ˆå™¨çš„ Cookie ä¸­ï¼Œä¸è¯¥åŸŸåç»‘å®šã€‚

4ï¼‰å¸¦ Cookie çš„åç»­è¯·æ±‚ï¼šå½“å‰ç«¯å†æ¬¡å‘ç›¸åŒåŸŸåçš„æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚å¤´ä¸­é™„å¸¦ä¹‹å‰ä¿å­˜çš„ Cookieï¼Œå…¶ä¸­åŒ…å« Session IDã€‚

5ï¼‰åç«¯éªŒè¯ä¼šè¯ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä»è¯·æ±‚å¤´ä¸­æå– Session IDï¼Œæ‰¾åˆ°å¯¹åº”çš„ Session æ•°æ®ã€‚

6ï¼‰è·å–ä¼šè¯ä¸­å­˜å‚¨çš„ä¿¡æ¯ï¼šåç«¯é€šè¿‡è¯¥ Session è·å–ä¹‹å‰å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚ç™»å½•åã€æƒé™ç­‰ï¼‰ï¼Œä»è€Œè¯†åˆ«ç”¨æˆ·èº«ä»½å¹¶æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚

<img src="https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729134851976.webp" alt="image-20250729134851976" style="zoom:50%;" />



## å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ

å¯ä»¥å°†æ¥å£åˆ†ä¸º 4 ç§æƒé™ï¼š

1. æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨
2. ç™»å½•ç”¨æˆ·æ‰èƒ½ä½¿ç”¨
3. æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç™»å½•ç”¨æˆ·èƒ½è¿›è¡Œæ›´å¤šæ“ä½œï¼ˆæ¯”å¦‚ç™»å½•åæŸ¥çœ‹å…¨æ–‡ï¼‰
4. ä»…ç®¡ç†å‘˜æ‰èƒ½ä½¿ç”¨

ä¼ ç»Ÿçš„æƒé™æ§åˆ¶æ–¹æ³•æ˜¯ï¼Œåœ¨æ¯ä¸ªæ¥å£å†…å•ç‹¬ç¼–å†™é€»è¾‘ï¼šå…ˆè·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶ååˆ¤æ–­ç”¨æˆ·çš„æƒé™æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚è¿™ç§æ–¹æ³•æœ€çµæ´»ï¼Œä½†æ˜¯ä¼šå†™å¾ˆå¤šé‡å¤çš„ä»£ç ï¼Œè€Œä¸”å…¶ä»–å¼€å‘è€…æ— æ³•ä¸€çœ¼å¾—çŸ¥æ¥å£æ‰€éœ€è¦çš„æƒé™ã€‚

æƒé™æ ¡éªŒå…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸€èˆ¬ä¼šé€šè¿‡ **Spring AOP åˆ‡é¢ + è‡ªå®šä¹‰æƒé™æ ¡éªŒæ³¨è§£ **å®ç°ç»Ÿä¸€çš„æ¥å£æ‹¦æˆªå’Œæƒé™æ ¡éªŒï¼›å¦‚æœæœ‰ç‰¹æ®Šçš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå†å•ç‹¬åœ¨æ¥å£ä¸­ç¼–ç ã€‚

ğŸ‘‡ å¦‚æœéœ€è¦æ›´å¤æ‚æ›´çµæ´»çš„æƒé™æ§åˆ¶ï¼Œå¯ä»¥å¼•å…¥ Shiro / Spring Security / Sa-Token ç­‰ä¸“é—¨çš„æƒé™ç®¡ç†æ¡†æ¶

è¿”å›å¤„ç†ç»“æœï¼ˆå¦‚é¡µé¢æˆ–æ•°æ®ï¼‰

## åç«¯å¼€å‘

### MyBatis-Flexä»£ç ç”Ÿæˆå™¨

#### 1.ä»€ä¹ˆæ˜¯MyBatis-Flexï¼Ÿ

è¿™æ¬¡æˆ‘ä»¬æ¥å­¦ä¸€ä¸ªæ–°çš„æ•°æ®è®¿é—®å±‚æ¡†æ¶MyBatis Flex,å®ƒçš„ä½œç”¨å’ŒMyBatis Plusä¸€æ ·ï¼Œéƒ½æ˜¯å¯¹ä¼ ç»Ÿæ“ä½œæ•°æ®åº“çš„MyBatisæ¡†æ¶è¿›è¡Œå¢å¼ºã€‚å®ƒçš„3å¤§ä¼˜åŠ¿ï¼š

- æ›´è½»é‡ï¼šMyBatis-Flexé™¤äº†MyBatisæœ¬èº«ï¼Œå†æ— ä»»ä½•ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œå› æ­¤ä¼šå¸¦æ¥æ›´é«˜çš„è‡ªä¸»æ€§ã€æŠŠæ§æ€§å’Œç¨³å®šæ€§ã€‚åœ¨ä»»ä½•ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œä¾èµ–è¶Šå¤šï¼Œç¨³å®šæ€§è¶Šå·®ã€‚
- æ›´çµæ´»ï¼šå°yBatis-Flexæä¾›äº†éå¸¸çµæ´»çš„QueryWrapper,:æ”¯æŒå…³è”æŸ¥è¯¢ã€å¤šè¡¨æŸ¥è¯¢ã€å¤šä¸»é”®ã€é€»è¾‘åˆ é™¤ã€ä¹è§‚é”æ›´æ–°ã€æ•°æ®å¡«å……ã€æ•°æ®è„±æ•ç­‰ç­‰ã€‚
- æ›´é«˜çš„æ€§èƒ½ï¼šMyBatis-FIexé€šè¿‡ç‹¬ç‰¹çš„æ¶æ„ï¼Œæ²¡æœ‰ä»»ä½•å°yBatisæ‹¦æˆªå™¨ã€åœ¨SQLæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰ä»»ä½•çš„SQL Parse,å› æ­¤ä¼šå¸¦æ¥æŒ‡æ•°çº§çš„æ€§èƒ½å¢é•¿ã€‚

å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°äº†å’ŒMyBatis Plusçš„åŠŸèƒ½å¯¹æ¯”ï¼Œæˆ‘è®¤ä¸ºæ¯”è¾ƒæœ‰ç«äº‰åŠ›çš„æ˜¯å®ƒæ”¯æŒ**å¤šè¡¨æŸ¥è¯¢**ï¼š

![image-20250729135300375](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729135300375.webp)

æ­¤å¤–ï¼Œåœ¨ybatis Flexä¸­ï¼Œæœ‰äº†ä¸€ä¸ªåç§°ä¸º`mybatis-flex-codegen`çš„æ¨¡å—ï¼Œæä¾›äº†å¯ä»¥é€šè¿‡æ•°æ®åº“è¡¨ï¼Œç”Ÿæˆä»£ç çš„åŠŸèƒ½ã€‚å½“æˆ‘ä»¬æŠŠæ•°æ®åº“è¡¨è®¾è®¡å®Œæˆåï¼Œå°±å¯ä»¥ä½¿ç”¨å…¶å¿«é€Ÿç”ŸæˆEntityã€Mapperã€Serviceã€.Controllerä»£ç ï¼Œèƒ½å¤§å¹…æé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚

#### 2. ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨

1. å¼•å…¥Mybatis-Flexä¾èµ–ï¼Œæ³¨æ„ç‰ˆæœ¬ï¼š

```xml
<dependency>
    <groupId>com.mybatis-flex</groupId>
    <artifactId>mybatis-flex-spring-boot3-starter</artifactId>
    <version>1.11.0</version>
</dependency>
```

è¿˜éœ€è¦ç”Ÿæˆå™¨ç›¸å…³ä¾èµ–ï¼š

```xml
<!-- ä»£ç ç”Ÿæˆæ¨¡å— -->
<dependency>
    <groupId>com.mybatis-flex</groupId>
    <artifactId>mybatis-flex-codegen</artifactId>
    <version>1.11.0</version>
</dependency>
<!-- æ•°æ®åº“è¿æ¥æ±  -->
<dependency>
    <groupId>com.zaxxer</groupId>
    <artifactId>HikariCP</artifactId>
</dependency>
```

2. æ•°æ®åº“ç›¸å…³é…ç½®

```yml
spring:
  application:
    name: ai-code-mother-api
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: xxx
    username: xxx
    password: xxx
```

3. å¼€å‘ç”Ÿæˆå™¨ï¼š

åœ¨æ ¹åŒ…ä¸‹æ–°å»ºgeneratoråŒ…ï¼Œæ–°å»ºå°MyBatisCodeGeneratorç±»ï¼Œç¼–å†™ä»£ç ç”Ÿæˆå™¨ã€‚å…ˆä»å®˜æ–¹å¤åˆ¶ç¤ºä¾‹ä»£ç ï¼Œç„¶åæŒ‰éœ€ä¿®æ”¹å³å¯ã€‚
åœ¨Mybatis Flexçš„ä»£ç ç”Ÿæˆå™¨ä¸­ï¼Œæ”¯æŒ8ç§ç±»å‹çš„çš„äº§ç‰©ç”Ÿæˆï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨å‰6ä¸ªå°±å¥½ï¼š

- Entityå®ä½“ç±»â˜‘
- Mapperæ˜ å°„ç±»â˜‘
- ServiceæœåŠ¡ç±»â˜‘
- ServicelmplæœåŠ¡å®ç°ç±»â˜‘
- Controlleræ§åˆ¶ç±»â˜‘
- MapperXmlæ–‡ä»¶â˜‘
- TableDefè¡¨å®šä¹‰è¾…åŠ©ç±»
- info iavaæ–‡ä»¶

```Java
/**
 * @Author: Chengfu Shi
 * @Description: ä»£ç ç”Ÿæˆå™¨
 **/
public class MyBatisCodeGenerator {

    public static final String[] DATABASE_NAMES = {"user"};

    public static void main(String[] args) {

        Dict dict = YamlUtil.loadByPath("application-local.yml");
        Map<String,Object> datasourceConfig = dict.getByPath("spring.datasource");
        String url = String.valueOf(datasourceConfig.get("url"));
        String username = String.valueOf(datasourceConfig.get("username"));
        String password = String.valueOf(datasourceConfig.get("password"));

        //é…ç½®æ•°æ®æº
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl(url);
        dataSource.setUsername(username);
        dataSource.setPassword(password);

        GlobalConfig globalConfig = createGlobalConfig();

        //é€šè¿‡ datasource å’Œ globalConfig åˆ›å»ºä»£ç ç”Ÿæˆå™¨
        Generator generator = new Generator(dataSource, globalConfig);

        //ç”Ÿæˆä»£ç 
        generator.generate();
    }


    public static GlobalConfig createGlobalConfig() {
        //åˆ›å»ºé…ç½®å†…å®¹
        GlobalConfig globalConfig = new GlobalConfig();

        //è®¾ç½®æ ¹åŒ…
        globalConfig.getPackageConfig()
                .setBasePackage("com.chengfu.aicodemotherapi.genresult");

        //è®¾ç½®è¡¨å‰ç¼€å’Œåªç”Ÿæˆå“ªäº›è¡¨ï¼ŒsetGenerateTable æœªé…ç½®æ—¶ï¼Œç”Ÿæˆæ‰€æœ‰è¡¨
        globalConfig.getStrategyConfig()
                .setGenerateTable(DATABASE_NAMES)
                //è®¾ç½®é€»è¾‘åˆ é™¤å­—æ®µ
                        .setLogicDeleteColumn("isDelete");

        //è®¾ç½®ç”Ÿæˆ entity å¹¶å¯ç”¨ Lombok
        globalConfig.enableEntity()
                .setWithLombok(true)
                .setJdkVersion(21);

        //è®¾ç½®ç”Ÿæˆ mapper
        globalConfig.enableMapper();
        globalConfig.enableMapperXml();

        // è®¾ç½®ç”Ÿæˆ service
        globalConfig.enableService();
        globalConfig.enableServiceImpl();

        // è®¾ç½®ç”Ÿæˆ controller
        globalConfig.enableController();

        // è®¾ç½®ç”Ÿæˆæ—¶é—´å’Œå­—ç¬¦ä¸²ä¸ºç©ºï¼Œé¿å…å¤šä½™çš„ä»£ç æ”¹åŠ¨
        globalConfig.getJavadocConfig()
                .setAuthor("Chengfu")
                .setSince("");

        return globalConfig;
    }
}

```

ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¸­è·å–æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œç”¨æ¥åˆå§‹åŒ–æ•°æ®æºã€‚ç„¶åè‡ªå®šä¹‰äº†ä¸€äº›ç”Ÿæˆé…ç½®ï¼ŒåŒ…æ‹¬ï¼š

- æŒ‡å®šé€»è¾‘åˆ é™¤å­—æ®µ
- ä½¿ç”¨çš„DKç‰ˆæœ¬
- ç”Ÿæˆçš„ä»£ç æ”¾åˆ°å“ªä¸ªåŒ…ï¼ˆå»ºè®®é€‰æ‹©ä¸€ä¸ªç‹¬ç«‹çš„åŒ…ï¼Œä¸è¦è·Ÿè€ä»£ç æ··ä¸€èµ·ï¼‰
- è¦ç”Ÿæˆå“ªäº›æ–‡ä»¶

4. è®¾ç½®mapperæ‰«æè·¯å¾„ï¼š

```java
@SpringBootApplication
@EnableAspectJAutoProxy(exposeProxy = true)
@MapperScan("com.chengfu.aicodemotherapi.mapper")
public class AiCodeMotherApiApplication {

    public static void main(String[] args) {
        SpringApplication.run(AiCodeMotherApiApplication.class, args);
    }

}
```

å¯åŠ¨é¡¹ç›®ï¼Œæ­£å¸¸è¿è¡Œï¼š

![image-20250729141344650](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729141344650.webp)

### æ•°æ®æ¨¡å‹å¼€å‘

#### 1.å®ä½“ç±»

ç”Ÿæˆçš„ä»£ç ä¹Ÿè®¸ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼Œæ¯”å¦‚æ•°æ®åº“å®ä½“ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ›´æ”¹å…¶å­—æ®µé…ç½®ï¼ŒæŒ‡å®šä¸»é”®ç”Ÿæˆç­–ç•¥ã€‚idé»˜è®¤æ˜¯è¿ç»­ç”Ÿæˆçš„ï¼Œå®¹æ˜“è¢«çˆ¬è™«æŠ“å–ï¼Œæ‰€ä»¥æ›´æ¢ç­–ç•¥ä¸ºASSIGN IDé›ªèŠ±ç®—æ³•ç”Ÿæˆã€‚
ä¿®æ”¹Userç±»çš„ä»£ç å¦‚ä¸‹ï¼š

```java
@Table("user")
public class User implements Serializable {

    @Id(keyType = KeyType.Generator, value = KeyGenerators.snowFlakeId)
    private Long id;
}

```

#### 2.æšä¸¾ç±»

å¯¹äºç”¨æˆ·è§’è‰²è¿™æ ·å€¼çš„æ•°é‡æœ‰é™çš„ã€å¯æšä¸¾çš„å­—æ®µï¼Œæœ€å¥½å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œä¾¿äºåœ¨é¡¹ç›®ä¸­è·å–å€¼ã€å‡å°‘æšä¸¾å€¼è¾“å…¥é”™è¯¯çš„æƒ…å†µã€‚
åœ¨`model.enums`åŒ…ä¸‹æ–°å»ºUserRoleEnum:

```java
@Getter
public enum UserRoleEnum {

    USER("ç”¨æˆ·", "user"),
    ADMIN("ç®¡ç†å‘˜", "admin");

    private final String text;

    private final String value;

    UserRoleEnum(String text, String value) {
        this.text = text;
        this.value = value;
    }

    /**
     * æ ¹æ® value è·å–æšä¸¾
     *
     * @param value æšä¸¾å€¼çš„value
     * @return æšä¸¾å€¼
     */
    public static UserRoleEnum getEnumByValue(String value) {
        if (ObjUtil.isEmpty(value)) {
            return null;
        }
        for (UserRoleEnum anEnum : UserRoleEnum.values()) {
            if (anEnum.value.equals(value)) {
                return anEnum;
            }
        }
        return null;
    }
}

```

---

ä¸‹é¢è¿›è¡Œå„æ¥å£å¼€å‘

### ç”¨æˆ·æ³¨å†Œ

#### 1.æ•°æ®æ¨¡å‹

åœ¨`model.dto.user`ä¸‹æ–°å»ºç”¨äºæ¥å—è¯·æ±‚å‚æ•°çš„ç±»ï¼š

```java
@Data
public class UserRegisterRequest implements Serializable {

    private static final long serialVersionUID = 3191241716373120793L;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * å¯†ç 
     */
    private String userPassword;

    /**
     * ç¡®è®¤å¯†ç 
     */
    private String checkPassword;
}
```

#### 2.æœåŠ¡å¼€å‘

åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ï¼š

```java
/**
 * ç”¨æˆ·æ³¨å†Œ
 *
 * @param userAccount   ç”¨æˆ·è´¦æˆ·
 * @param userPassword  ç”¨æˆ·å¯†ç 
 * @param checkPassword æ ¡éªŒå¯†ç 
 * @return æ–°ç”¨æˆ· id
 */
long userRegister(String userAccount, String userPassword, String checkPassword);

```

å®ç°ç±»ï¼š

```java
@Override
public long userRegister(String userAccount, String userPassword, String checkPassword) {
    // 1. æ ¡éªŒ
    if (StrUtil.hasBlank(userAccount, userPassword, checkPassword)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "å‚æ•°ä¸ºç©º");
    }
    if (userAccount.length() < 4) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·è´¦å·è¿‡çŸ­");
    }
    if (userPassword.length() < 8 || checkPassword.length() < 8) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·å¯†ç è¿‡çŸ­");
    }
    if (!userPassword.equals(checkPassword)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´");
    }
    // 2. æ£€æŸ¥æ˜¯å¦é‡å¤
    QueryWrapper queryWrapper = new QueryWrapper();
    queryWrapper.eq("userAccount", userAccount);
    long count = this.mapper.selectCountByQuery(queryWrapper);
    if (count > 0) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "è´¦å·é‡å¤");
    }
    // 3. åŠ å¯†
    String encryptPassword = getEncryptPassword(userPassword);
    // 4. æ’å…¥æ•°æ®
    User user = new User();
    user.setUserAccount(userAccount);
    user.setUserPassword(encryptPassword);
    user.setUserName("æ— å");
    user.setUserRole(UserRoleEnum.USER.getValue());
    boolean saveResult = this.save(user);
    if (!saveResult) {
        throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ³¨å†Œå¤±è´¥ï¼Œæ•°æ®åº“é”™è¯¯");
    }
    return user.getId();
}
```

åŠ å¯†å‡½æ•°ï¼š

```java
@Override
public String getEncryptPassword(String userPassword) {
    // ç›å€¼ï¼Œæ··æ·†å¯†ç 
    final String SALT = "chengfu";
    return DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());
}
```

#### 3. æ¥å£å¼€å‘

```java
@RestController
@RequestMapping("/user")
public class UserController {

    @Resource
    private UserService userService;

    /**
     * ç”¨æˆ·æ³¨å†Œ
     *
     * @param userRegisterRequest ç”¨æˆ·æ³¨å†Œè¯·æ±‚
     * @return æ³¨å†Œç»“æœ
     */
    @PostMapping("register")
    public BaseResponse<Long> userRegister(@RequestBody UserRegisterRequest userRegisterRequest) {
        ThrowUtils.throwIf(userRegisterRequest == null, ErrorCode.PARAMS_ERROR);
        String userAccount = userRegisterRequest.getUserAccount();
        String userPassword = userRegisterRequest.getUserPassword();
        String checkPassword = userRegisterRequest.getCheckPassword();
        long result = userService.userRegister(userAccount, userPassword, checkPassword);
        return ResultUtils.success(result);
    }
}
```

#### 4. æµ‹è¯•

![image-20250729143324987](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729143324987.webp)

### ç”¨æˆ·ç™»å½•

#### 1. æ•°æ®æ¨¡å‹

åœ¨`model.dto.user`åŒ…ä¸‹æ–°å»ºç™»å½•è¯·æ±‚

```java
@Data
public class UserLoginRequest implements Serializable {

    private static final long serialVersionUID = 3191241716373120793L;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * å¯†ç 
     */
    private String userPassword;
}
```

#### 2. æ•°æ®è„±æ•

æ— è®ºæ˜¯ç”¨æˆ·æ³¨å†Œè¿˜æ˜¯ç”¨æˆ·ç™»å½•æ¥å£ï¼Œéƒ½åº”è¯¥è¿”å›å·²ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œä¸”ä¸€å®šè¦å¯¹è¿”å›ç»“æœè¿›è¡Œè„±æ•å¤„ç†ï¼Œä¸èƒ½ç›´æ¥å°†æ•°æ®åº“æŸ¥åˆ°çš„æ‰€æœ‰ä¿¡æ¯éƒ½è¿”å›ç»™äº†å‰ç«¯ï¼ˆåŒ…æ‹¬å¯†ç ï¼‰ã€‚
åœ¨`model.vo`åŒ…ä¸‹æ–°å»º`LoginuserVo`ç±»ï¼Œè¡¨ç¤ºè„±æ•åçš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼š

```java
@Data
public class LoginUserVO implements Serializable {

    /**
     * ç”¨æˆ· id
     */
    private Long id;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private LocalDateTime createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    private LocalDateTime updateTime;

    private static final long serialVersionUID = 1L;
}

```

åœ¨UserServiceä¸­æ–°å¢è·å–è„±æ•åçš„å·²ç™»å½•ç”¨æˆ·ä¿¡æ¯æ–¹æ³•ï¼š

```java
/**
 * è·å–è„±æ•çš„å·²ç™»å½•ç”¨æˆ·ä¿¡æ¯
 *
 * @return
 */
LoginUserVO getLoginUserVO(User user);

```

ç¼–å†™æ–¹æ³•å¯¹åº”çš„å®ç°ç±»ï¼Œå…¶å®å°±æ˜¯å°†Userç±»çš„å±æ€§å¤åˆ¶åˆ°LoginUserVOä¸­ï¼Œä¸å­˜åœ¨çš„å­—æ®µå°±è¢«è¿‡æ»¤æ‰äº†.

#### 3.æœåŠ¡å¼€å‘

åœ¨`service`åŒ…çš„UserServiceä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼š

```java
/**
 * ç”¨æˆ·ç™»å½•
 *
 * @param userAccount  ç”¨æˆ·è´¦æˆ·
 * @param userPassword ç”¨æˆ·å¯†ç 
 * @param request
 * @return è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯
 */
LoginUserVO userLogin(String userAccount, String userPassword, HttpServletRequest request);

```

åœ¨UserServicelmplä¸­å¢åŠ å®ç°ä»£ç ï¼Œæ³¨æ„å¤šè¡¥å……ä¸€äº›æ ¡éªŒæ¡ä»¶ï¼Œåœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨å½“å‰çš„Sessionä¸­ã€‚ä»£ç åŠ ä¸‹ï¼š

```java
    @Override
    public LoginUserVO userLogin(String userAccount, String userPassword, HttpServletRequest request) {
        // 1. æ ¡éªŒ
        if (StrUtil.hasBlank(userAccount, userPassword)) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "å‚æ•°ä¸ºç©º");
        }
        if (userAccount.length() < 4) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "è´¦å·é”™è¯¯");
        }
        if (userPassword.length() < 8) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "å¯†ç é”™è¯¯");
        }
        // 2. åŠ å¯†
        String encryptPassword = getEncryptPassword(userPassword);
        // æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        QueryWrapper queryWrapper = new QueryWrapper();
        queryWrapper.eq("userAccount", userAccount);
        queryWrapper.eq("userPassword", encryptPassword);
        User user = this.mapper.selectOneByQuery(queryWrapper);
        // ç”¨æˆ·ä¸å­˜åœ¨
        if (user == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·ä¸å­˜åœ¨æˆ–å¯†ç é”™è¯¯");
        }
        // 3. è®°å½•ç”¨æˆ·çš„ç™»å½•æ€
        request.getSession().setAttribute(USER_LOGIN_STATE, user);
        // 4. è·å¾—è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯
        return this.getLoginUserVO(user);
    }
```

æ³¨æ„ï¼Œç”±äºæ³¨å†Œç”¨æˆ·æ—¶å­˜å…¥æ•°æ®åº“çš„å¯†ç æ˜¯åŠ å¯†åçš„ï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œä¹Ÿè¦å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŒæ ·ç®—æ³•çš„åŠ å¯†ï¼Œèƒ½è·Ÿæ•°æ®åº“çš„ä¿¡æ¯å¯¹åº”ä¸Šã€‚
å¯ä»¥æŠŠä¸Šè¿°çš„Sessionç†è§£ä¸ºä¸€ä¸ªMap,å¯ä»¥ç»™Mapè®¾ç½®keyå’Œvalue,æ¯ä¸ªä¸åŒçš„SessionlDå¯¹åº”çš„Sessionå­˜å‚¨
ä¸åŒçš„ï¼Œä¸ç”¨æ‹…å¿ƒä¼šæ±¡æŸ“ã€‚æ‰€ä»¥ä¸Šè¿°ä»£ç ä¸­ï¼Œç»™Sessionè®¾ç½®äº†å›ºå®šçš„key(USER LOGIN_STATE),å¯ä»¥å°†è¿™ä¸ªkeyå€¼å–ä¸ºå¸¸é‡ï¼Œä¾¿äºåç»­è·å–ã€‚

åœ¨`constant`åŒ…ä¸‹æ–°å»ºUserConstantç±»ï¼Œç»Ÿä¸€å£°æ˜ç”¨æˆ·ç›¸å…³çš„å¸¸é‡ï¼š

```java
public interface UserConstant {

    /**
     * ç”¨æˆ·ç™»å½•æ€é”®
     */
    String USER_LOGIN_STATE = "user_login";

    //  region æƒé™

    /**
     * é»˜è®¤è§’è‰²
     */
    String DEFAULT_ROLE = "user";

    /**
     * ç®¡ç†å‘˜è§’è‰²
     */
    String ADMIN_ROLE = "admin";
    
    // endregion
}
```

#### 4. æ¥å£å¼€å‘

```java
@PostMapping("/login")
public BaseResponse<LoginUserVO> userLogin(@RequestBody UserLoginRequest userLoginRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(userLoginRequest == null, ErrorCode.PARAMS_ERROR);
    String userAccount = userLoginRequest.getUserAccount();
    String userPassword = userLoginRequest.getUserPassword();
    LoginUserVO loginUserVO = userService.userLogin(userAccount, userPassword, request);
    return ResultUtils.success(loginUserVO);
}

```

#### 5. æµ‹è¯•

![image-20250729144414614](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729144414614.webp)

### è·å–å½“å‰ç™»å½•ç”¨æˆ·

å¯ä»¥ä»requestè¯·æ±‚å¯¹è±¡å¯¹åº”çš„Sessionä¸­ç›´æ¥è·å–åˆ°ä¹‹å‰ä¿å­˜çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€å…¶ä»–è¯·æ±‚å‚æ•°ã€‚

#### 1. æœåŠ¡å¼€å‘

```java
/**
 * è·å–å½“å‰ç™»å½•ç”¨æˆ·
 *
 * @param request
 * @return
 */
User getLoginUser(HttpServletRequest request);
```

å®ç°ç±»ï¼š

```java
@Override
public User getLoginUser(HttpServletRequest request) {
    // å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•
    Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
    User currentUser = (User) userObj;
    if (currentUser == null || currentUser.getId() == null) {
        throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
    }
    // ä»æ•°æ®åº“æŸ¥è¯¢ï¼ˆè¿½æ±‚æ€§èƒ½çš„è¯å¯ä»¥æ³¨é‡Šï¼Œç›´æ¥è¿”å›ä¸Šè¿°ç»“æœï¼‰
    long userId = currentUser.getId();
    currentUser = this.getById(userId);
    if (currentUser == null) {
        throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
    }
    return currentUser;
}

```

#### 2.æ¥å£å¼€å‘

```java
@GetMapping("/get/login")
public BaseResponse<LoginUserVO> getLoginUser(HttpServletRequest request) {
    User loginUser = userService.getLoginUser(request);
    return ResultUtils.success(userService.getLoginUserVO(loginUser));
}
```

### ç”¨æˆ·æ³¨é”€

å¯ä»¥ä»requestè¯·æ±‚å¯¹è±¡å¯¹åº”çš„Sessionä¸­ç›´æ¥è·å–åˆ°ä¹‹å‰ä¿å­˜çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ¥å®Œæˆæ³¨é”€ï¼Œæ— éœ€å…¶ä»–è¯·æ±‚å‚æ•°ã€‚

#### 1.æœåŠ¡å¼€å‘

```java
/**
 * ç”¨æˆ·æ³¨é”€
 *
 * @param request
 * @return
 */
boolean userLogout(HttpServletRequest request);
```

å®ç°ç±»

```java
@Override
public boolean userLogout(HttpServletRequest request) {
    // å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•
    Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
    if (userObj == null) {
        throw new BusinessException(ErrorCode.OPERATION_ERROR, "æœªç™»å½•");
    }
    // ç§»é™¤ç™»å½•æ€
    request.getSession().removeAttribute(USER_LOGIN_STATE);
    return true;
}
```

#### 2.æ¥å£å¼€å‘

```java
@PostMapping("/logout")
public BaseResponse<Boolean> userLogout(HttpServletRequest request) {
    ThrowUtils.throwIf(request == null, ErrorCode.PARAMS_ERROR);
    boolean result = userService.userLogout(request);
    return ResultUtils.success(result);
}
```

### ç”¨æˆ·ä¿®æ”¹ä¸ªäººä¿¡æ¯

#### 1.æ•°æ®æ¨¡å‹

```java
@Data
public class UserEditRequest implements Serializable {
    private static final long serialVersionUID = 1L;
    private Long id;
    private String userName;

    private String userAvatar;

    private String userProfile;

}
```

#### 2.æœåŠ¡å¼€å‘

```java
    /**
     * ç¼–è¾‘ç”¨æˆ·
     *
     * @param userEditRequest
     * @param request
     * @return
     */
    boolean userEdit(UserEditRequest userEditRequest, HttpServletRequest request);
```

å®ç°ç±»

```java
@Override
    public boolean userEdit(UserEditRequest userEditRequest, HttpServletRequest request) {
        // 1. å‚æ•°æ ¡éªŒ
        if (userEditRequest == null || userEditRequest.getId() == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "å‚æ•°ä¸ºç©º");
        }

        // 2. è·å–å½“å‰ç™»å½•ç”¨æˆ·
        User loginUser = getLoginUser(request);
        Long loginUserId = loginUser.getId();
        Long targetUserId = userEditRequest.getId();

        // 3. éªŒè¯æƒé™ï¼ˆåªèƒ½ç¼–è¾‘è‡ªå·±çš„ä¿¡æ¯ï¼Œé™¤éæ˜¯ç®¡ç†å‘˜ï¼‰
        if (!loginUserId.equals(targetUserId) && !UserRoleEnum.ADMIN.getValue().equals(loginUser.getUserRole())) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR, "æ— æƒé™ç¼–è¾‘è¯¥ç”¨æˆ·");
        }

        // 4. æ„é€ æ›´æ–°å¯¹è±¡
        User updateUser = new User();
        updateUser.setId(targetUserId);

        // 5. åªè®¾ç½®éç©ºå­—æ®µ
        if (StrUtil.isNotBlank(userEditRequest.getUserName())) {
            updateUser.setUserName(userEditRequest.getUserName());
        }
        if (StrUtil.isNotBlank(userEditRequest.getUserAvatar())) {
            updateUser.setUserAvatar(userEditRequest.getUserAvatar());
        }
        if (StrUtil.isNotBlank(userEditRequest.getUserProfile())) {
            updateUser.setUserProfile(userEditRequest.getUserProfile());
        }

        // 6. æ‰§è¡Œæ›´æ–°
        boolean updateResult = this.updateById(updateUser);
        if (!updateResult) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ›´æ–°å¤±è´¥");
        }

        return true;
    }

```

#### 3. æ¥å£å¼€å‘

```java
    @PutMapping("/edit")
    public BaseResponse<Boolean> userEdit(@RequestBody UserEditRequest userEditRequest, HttpServletRequest request) {
        ThrowUtils.throwIf(userEditRequest == null, ErrorCode.PARAMS_ERROR);
        boolean result = userService.userEdit(userEditRequest, request);
        ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR,"ç¼–è¾‘å¤±è´¥");
        return ResultUtils.success(result);
    }
```

#### 4. æµ‹è¯•

![image-20250729150353965](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729150353965.webp)

### ç”¨æˆ·æƒé™æ§åˆ¶

æƒé™æ ¡éªŒå…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸€èˆ¬ä¼šé€šè¿‡**Spring AOPåˆ‡é¢+è‡ªå®šä¹‰æƒé™æ ¡éªŒæ³¨è§£**å®ç°ç»Ÿä¸€çš„æ¥å£æ‹¦æˆªå’Œæƒé™æ ¡éªŒã€‚å¦‚æœæœ‰ç‰¹æ®Šçš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå†å•ç‹¬åœ¨æ¥å£ä¸­ç¼–ç ã€‚

#### 1. æƒé™æ ¡éªŒæ³¨è§£

é¦–å…ˆç¼–å†™æƒé™æ ¡éªŒæ³¨è§£ï¼Œæ”¾åˆ°`annotation`åŒ…ä¸‹ï¼š

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface AuthCheck {

    /**
     * å¿…é¡»æœ‰æŸä¸ªè§’è‰²
     */
    String mustRole() default "";
}

```

#### 2. æƒé™æ ¡éªŒåˆ‡é¢
ç¼–å†™æƒé™æ ¡éªŒAOP,é‡‡ç”¨ç¯ç»•é€šçŸ¥ï¼Œåœ¨æ‰“ä¸Šè¯¥æ³¨è§£çš„æ–¹æ³•æ‰§è¡Œå‰åè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œæ¯”å¦‚æ ¡éªŒæƒé™ã€‚
ä»£ç å¦‚ä¸‹ï¼Œæ”¾åˆ°aopåŒ…ä¸‹ï¼š

```java
@Aspect
@Component
public class AuthInterceptor {

    @Resource
    private UserService userService;

    /**
     * æ‰§è¡Œæ‹¦æˆª
     *
     * @param joinPoint åˆ‡å…¥ç‚¹
     * @param authCheck æƒé™æ ¡éªŒæ³¨è§£
     */
    @Around("@annotation(authCheck)")
    public Object doInterceptor(ProceedingJoinPoint joinPoint, AuthCheck authCheck) throws Throwable {
        String mustRole = authCheck.mustRole();
        RequestAttributes requestAttributes = RequestContextHolder.currentRequestAttributes();
        HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();
        // å½“å‰ç™»å½•ç”¨æˆ·
        User loginUser = userService.getLoginUser(request);
        UserRoleEnum mustRoleEnum = UserRoleEnum.getEnumByValue(mustRole);
        // ä¸éœ€è¦æƒé™ï¼Œæ”¾è¡Œ
        if (mustRoleEnum == null) {
            return joinPoint.proceed();
        }
        // ä»¥ä¸‹ä¸ºï¼šå¿…é¡»æœ‰è¯¥æƒé™æ‰é€šè¿‡
        // è·å–å½“å‰ç”¨æˆ·å…·æœ‰çš„æƒé™
        UserRoleEnum userRoleEnum = UserRoleEnum.getEnumByValue(loginUser.getUserRole());
        // æ²¡æœ‰æƒé™ï¼Œæ‹’ç»
        if (userRoleEnum == null) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        // è¦æ±‚å¿…é¡»æœ‰ç®¡ç†å‘˜æƒé™ï¼Œä½†ç”¨æˆ·æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼Œæ‹’ç»
        if (UserRoleEnum.ADMIN.equals(mustRoleEnum) && !UserRoleEnum.ADMIN.equals(userRoleEnum)) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        // é€šè¿‡æƒé™æ ¡éªŒï¼Œæ”¾è¡Œ
        return joinPoint.proceed();
    }
}
```

#### 3.ä½¿ç”¨æ³¨è§£
åªè¦ç»™æ–¹æ³•æ·»åŠ äº†@AuthCheckæ³¨è§£ï¼Œå°±å¿…é¡»è¦ç™»å½•ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
å¯ä»¥è®¾ç½®mustRoleä¸ºç®¡ç†å‘˜ï¼Œè¿™æ ·ä»…ç®¡ç†å‘˜æ‰èƒ½ä½¿ç”¨è¯¥æ¥å£ï¼š
```java
@AuthCheck(mustRole Userconstant.ADMIN ROLE)
```

å¯¹äºä¸éœ€è¦ç™»å½•å°±èƒ½ä½¿ç”¨çš„æ¥å£ï¼Œä¸éœ€è¦ä½¿ç”¨è¯¥æ³¨è§£ã€‚

### ç”¨æˆ·ç®¡ç†

ç”¨æˆ·ç®¡ç†éœ€æ±‚å…·ä½“å¯ä»¥æ‹†åˆ†ä¸ºï¼š
ã€ç®¡ç†å‘˜ã€‘åˆ›å»ºç”¨æˆ·
ã€ç®¡ç†å‘˜ã€‘æ ¹æ®idåˆ é™¤ç”¨æˆ·
ã€ç®¡ç†å‘˜ã€‘æ›´æ–°ç”¨æˆ·
ã€ç®¡ç†å‘˜ã€‘åˆ†é¡µè·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆéœ€è¦è„±æ•ï¼‰
ã€ç®¡ç†å‘˜ã€‘æ ¹æ®idè·å–ç”¨æˆ·ï¼ˆæœªè„±æ•ï¼‰
æ ¹æ®idè·å–ç”¨æˆ·ï¼ˆè„±æ•ï¼‰

#### 1. æ•°æ®æ¨¡å‹

1. æ¯ä¸ªæ“ä½œéƒ½éœ€è¦æä¾›ä¸€ä¸ªè¯·æ±‚ç±»ï¼Œéƒ½æ”¾åœ¨`dto.user`åŒ…ä¸‹ã€‚

ç”¨æˆ·åˆ›å»ºè¯·æ±‚

```java
@Data
public class UserAddRequest implements Serializable {

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²: user, admin
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}

```

ç”¨æˆ·æ›´æ–°è¯·æ±‚

```java
@Data
public class UserUpdateRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}

```

ç”¨æˆ·æŸ¥è¯¢è¯·æ±‚

```java
@EqualsAndHashCode(callSuper = true)
@Data
public class UserQueryRequest extends PageRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin/ban
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}

```

2. ç”±äºè¦æä¾›è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£ï¼Œéœ€è¦å’Œè·å–å½“å‰ç™»å½•ç”¨æˆ·æ¥å£ä¸€æ ·å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œè„±æ•
   åœ¨`model.vo`åŒ…ä¸‹æ–°å»ºUserVO,è¡¨ç¤ºè„±æ•åçš„ç”¨æˆ·ï¼š

```java
@Data
public class UserVO implements Serializable {

    /**
     * id
     */
    private Long id;
    
    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private LocalDateTime createTime;

    private static final long serialVersionUID = 1L;
}
```

#### 2. æœåŠ¡å¼€å‘

1. åœ¨UserServiceä¸­ç¼–å†™è·å–è„±æ•åçš„å•ä¸ªç”¨æˆ·ä¿¡æ¯ã€è·å–è„±æ•åçš„ç”¨æˆ·åˆ—è¡¨æ–¹æ³•ï¼š

```java
@Override
public UserVO getUserVO(User user) {
    if (user == null) {
        return null;
    }
    UserVO userVO = new UserVO();
    BeanUtil.copyProperties(user, userVO);
    return userVO;
}

@Override
public List<UserVO> getUserVOList(List<User> userList) {
    if (CollUtil.isEmpty(userList)) {
        return new ArrayList<>();
    }
    return userList.stream().map(this::getUserVO).collect(Collectors.toList());
}
```

2. é™¤äº†ä¸Šè¿°æ–¹æ³•å¤–ï¼Œå¯¹äºåˆ†é¡µæŸ¥è¯¢æ¥å£ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å‚æ•°æ¥æ„é€ SQLæŸ¥è¯¢ã€‚ç”±äºä½¿ç”¨lyBatis Flexæ¡†æ¶ï¼Œä¸ç”¨è‡ªå·±æ‹¼æ¥SQLäº†ï¼Œè€Œæ˜¯é€šè¿‡æ„é€ QueryWrapperå¯¹è±¡æ¥ç”ŸæˆSQLæŸ¥è¯¢ã€‚

å¯ä»¥åœ¨UserServiceä¸­ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œä¸“é—¨ç”¨äºå°†æŸ¥è¯¢è¯·æ±‚è½¬ä¸ºQueryWrapperå¯¹è±¡ï¼š
```java
@Override
public QueryWrapper getQueryWrapper(UserQueryRequest userQueryRequest) {
    if (userQueryRequest == null) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "è¯·æ±‚å‚æ•°ä¸ºç©º");
    }
    Long id = userQueryRequest.getId();
    String userAccount = userQueryRequest.getUserAccount();
    String userName = userQueryRequest.getUserName();
    String userProfile = userQueryRequest.getUserProfile();
    String userRole = userQueryRequest.getUserRole();
    String sortField = userQueryRequest.getSortField();
    String sortOrder = userQueryRequest.getSortOrder();
    return QueryWrapper.create()
            .eq("id", id)
            .eq("userRole", userRole)
            .like("userAccount", userAccount)
            .like("userName", userName)
            .like("userProfile", userProfile)
            .orderBy(sortField, "ascend".equals(sortOrder));
}

```

#### 3. æ¥å£å¼€å‘

ä¸Šè¿°åŠŸèƒ½å…¶å®éƒ½æ˜¯æ ·æ¿ä»£ç ï¼Œä¿—ç§°â€œå¢åˆ æ”¹æŸ¥â€ã€‚
ä»£ç å®ç°æ¯”è¾ƒç®€å•ï¼Œæ³¨æ„æ·»åŠ å¯¹åº”çš„æƒé™æ³¨è§£ã€åšå¥½å‚æ•°æ ¡éªŒå³å¯ï¼š

```java
/**
 * åˆ›å»ºç”¨æˆ·
 */
@PostMapping("/add")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Long> addUser(@RequestBody UserAddRequest userAddRequest) {
    ThrowUtils.throwIf(userAddRequest == null, ErrorCode.PARAMS_ERROR);
    User user = new User();
    BeanUtil.copyProperties(userAddRequest, user);
    // é»˜è®¤å¯†ç  12345678
    final String DEFAULT_PASSWORD = "12345678";
    String encryptPassword = userService.getEncryptPassword(DEFAULT_PASSWORD);
    user.setUserPassword(encryptPassword);
    boolean result = userService.save(user);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
    return ResultUtils.success(user.getId());
}

/**
 * æ ¹æ® id è·å–ç”¨æˆ·ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
 */
@GetMapping("/get")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<User> getUserById(long id) {
    ThrowUtils.throwIf(id <= 0, ErrorCode.PARAMS_ERROR);
    User user = userService.getById(id);
    ThrowUtils.throwIf(user == null, ErrorCode.NOT_FOUND_ERROR);
    return ResultUtils.success(user);
}

/**
 * æ ¹æ® id è·å–åŒ…è£…ç±»
 */
@GetMapping("/get/vo")
public BaseResponse<UserVO> getUserVOById(long id) {
    BaseResponse<User> response = getUserById(id);
    User user = response.getData();
    return ResultUtils.success(userService.getUserVO(user));
}

/**
 * åˆ é™¤ç”¨æˆ·
 */
@PostMapping("/delete")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Boolean> deleteUser(@RequestBody DeleteRequest deleteRequest) {
    if (deleteRequest == null || deleteRequest.getId() <= 0) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    boolean b = userService.removeById(deleteRequest.getId());
    return ResultUtils.success(b);
}

/**
 * æ›´æ–°ç”¨æˆ·
 */
@PostMapping("/update")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Boolean> updateUser(@RequestBody UserUpdateRequest userUpdateRequest) {
    if (userUpdateRequest == null || userUpdateRequest.getId() == null) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    User user = new User();
    BeanUtil.copyProperties(userUpdateRequest, user);
    boolean result = userService.updateById(user);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
    return ResultUtils.success(true);
}

/**
 * åˆ†é¡µè·å–ç”¨æˆ·å°è£…åˆ—è¡¨ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
 *
 * @param userQueryRequest æŸ¥è¯¢è¯·æ±‚å‚æ•°
 */
@PostMapping("/list/page/vo")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Page<UserVO>> listUserVOByPage(@RequestBody UserQueryRequest userQueryRequest) {
    ThrowUtils.throwIf(userQueryRequest == null, ErrorCode.PARAMS_ERROR);
    long pageNum = userQueryRequest.getPageNum();
    long pageSize = userQueryRequest.getPageSize();
    Page<User> userPage = userService.page(Page.of(pageNum, pageSize),
            userService.getQueryWrapper(userQueryRequest));
    // æ•°æ®è„±æ•
    Page<UserVO> userVOPage = new Page<>(pageNum, pageSize, userPage.getTotalRow());
    List<UserVO> userVOList = userService.getUserVOList(userPage.getRecords());
    userVOPage.setRecords(userVOList);
    return ResultUtils.success(userVOPage);
}

```

### æ•°æ®ç²¾åº¦ä¿®å¤

```java
/**
 * Spring MVC Json é…ç½®
 */
@JsonComponent
public class JsonConfig {

    /**
     * æ·»åŠ  Long è½¬ json ç²¾åº¦ä¸¢å¤±çš„é…ç½®
     */
    @Bean
    public ObjectMapper jacksonObjectMapper(Jackson2ObjectMapperBuilder builder) {
        ObjectMapper objectMapper = builder.createXmlMapper(false).build();
        SimpleModule module = new SimpleModule();
        module.addSerializer(Long.class, ToStringSerializer.instance);
        module.addSerializer(Long.TYPE, ToStringSerializer.instance);
        objectMapper.registerModule(module);
        return objectMapper;
    }
}
```

## å‰ç«¯å¼€å‘

### æ–°å»ºé¡µé¢å’Œè·¯ç”±

![image-20250729153743290](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729153743290.webp)

ä¿®æ”¹è·¯ç”±é…ç½®ï¼š

```ts
routes: [
  {
    path: '/',
    name: 'ä¸»é¡µ',
    component: HomePage,
  },
  {
    path: '/user/login',
    name: 'ç”¨æˆ·ç™»å½•',
    component: UserLoginPage,
  },
  {
    path: '/user/register',
    name: 'ç”¨æˆ·æ³¨å†Œ',
    component: UserRegisterPage,
  },
  {
    path: '/admin/userManage',
    name: 'ç”¨æˆ·ç®¡ç†',
    component: UserManagePage,
  },
],

```

è®°å¾—æ‰§è¡Œä¸€ä¸‹openapiå·¥å…·ç”Ÿæˆæ¥å£å¯¹åº”çš„è¯·æ±‚ä»£ç ï¼Œæ¯æ¬¡åç«¯æ”¹åŠ¨æ—¶éƒ½éœ€è¦è¿™ä¹ˆåšã€‚

### ç”¨æˆ·ç™»å½•ä¸æ³¨å†Œé¡µé¢

```vue
<template>
  <div class="center">
    <h1>Sign in/ Sign up</h1>
    <div class="logon">
      <div :class="overlaylong">
        <div class="overlaylong-Signin" v-if="disfiex == 0">
          <h2 class="overlaylongH2">Sign in</h2>
          <a-form
            style="max-width: 700px; margin: 0 auto"
            label-align="left"
            :label-col="{ span: 4 }"
            :wrapper-col="{ span: 20 }"
            :model="form1"
            @finish="handleLogin"
          >
            <a-form-item
              name="userAccount"
              label="è´¦å·"
              :rules="[
                { required: true, message: 'è¯·è¾“å…¥è´¦å·' },
                { min: 4, message: 'è´¦å·ä¸å°‘äº 4 ä½' },
                { max: 20, message: 'è´¦å·ä¸è¶…è¿‡ 20 ä½' },
              ]"
            >
              <a-input
                style="width: 250px"
                v-model:value="form1.userAccount"
                placeholder="è¯·è¾“å…¥è´¦å·"
              />
            </a-form-item>
            <a-form-item
              name="userPassword"
              label="å¯†ç "
              :rules="[
                { required: true, message: 'è¯·è¾“å…¥å¯†ç ' },
                { min: 8, message: 'å¯†ç ä¸å°‘äº 8 ä½' },
                { max: 20, message: 'å¯†ç ä¸è¶…è¿‡ 20 ä½' },
                {
                  pattern: passwordPattern,
                  message: 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šç¬¦å·',
                },
              ]"
            >
              <a-input-password
                style="width: 250px"
                v-model:value="form1.userPassword"
                placeholder="è¯·è¾“å…¥å¯†ç "
              />
              <h3 @click="message.info('è¯·è”ç³»ç®¡ç†å‘˜')">Forgot your password?</h3>
            </a-form-item>
            <a-form-item :wrapper-col="{ offset: 4, span: 20 }">
              <a-button type="primary" html-type="submit" class="inupbutton">ç™»å½•</a-button>
            </a-form-item>
          </a-form>
        </div>
        <div class="overlaylong-Signup" v-if="disfiex == 1">
          <h2 class="overlaylongH2">Registered Account</h2>
          <a-form
            style="max-width: 700px; margin: 0 auto"
            label-align="left"
            :label-col="{ span: 7 }"
            :wrapper-col="{ span: 20 }"
            :model="form2"
            @finish="handleRegister"
          >
            <a-form-item
              name="userAccount"
              label="è´¦å·"
              :rules="[
                { required: true, message: 'è¯·è¾“å…¥è´¦å·' },
                { min: 4, message: 'è´¦å·ä¸å°‘äº 4 ä½' },
                { max: 20, message: 'è´¦å·ä¸è¶…è¿‡ 20 ä½' },
              ]"
            >
              <a-input
                style="width: 200px"
                v-model:value="form2.userAccount"
                placeholder="è¯·è¾“å…¥è´¦å·"
              />
            </a-form-item>
            <a-form-item
              name="userPassword"
              label="å¯†ç "
              :rules="[
                { required: true, message: 'è¯·è¾“å…¥å¯†ç ' },
                { min: 8, message: 'å¯†ç ä¸å°‘äº 8 ä½' },
                { max: 20, message: 'å¯†ç ä¸è¶…è¿‡ 20 ä½' },
                {
                  pattern: passwordPattern,
                  message: 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šç¬¦å·',
                },
              ]"
            >
              <a-input-password
                style="width: 200px"
                v-model:value="form2.userPassword"
                placeholder="è¯·è¾“å…¥å¯†ç "
              />
            </a-form-item>
            <a-form-item
              name="checkPassword"
              label="ç¡®è®¤å¯†ç "
              :rules="[
                { required: true, message: 'è¯·å†æ¬¡è¾“å…¥å¯†ç ' },
                { min: 8, message: 'å¯†ç ä¸å°‘äº 8 ä½' },
                { max: 20, message: 'å¯†ç ä¸è¶…è¿‡ 20 ä½' },
                {
                  pattern: passwordPattern,
                  message: 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šç¬¦å·',
                },
              ]"
            >
              <a-input-password
                style="width: 200px"
                v-model:value="form2.checkPassword"
                placeholder="è¯·è¾“å…¥ç¡®è®¤å¯†ç "
              />
            </a-form-item>
            <a-form-item :wrapper-col="{ offset: 4, span: 20 }">
              <a-button type="primary" html-type="submit" class="inupbutton">æ³¨å†Œ</a-button>
            </a-form-item>
          </a-form>
        </div>
      </div>
      <div :class="overlaytitle">
        <div class="overlaytitle-Signin" v-if="disfiex == 0">
          <h2 class="overlaytitleH2">Hello,Friend!</h2>
          <p class="overlaytitleP">Enter your personal details and start journey with us</p>
          <div class="buttongohs" @click="Signin">Sign up</div>
        </div>
        <div class="overlaytitle-Signup" v-if="disfiex == 1">
          <h2 class="overlaytitleH2">Welcome Back!</h2>
          <p class="overlaytitleP">
            To keep connected with us please login with your personal info
          </p>
          <div class="buttongohs" @click="Signup">Sign in</div>
        </div>
      </div>
    </div>
  </div>
</template>
<script setup lang="ts">
import { reactive, ref } from 'vue'
import { useLoginUserStore } from '@/stores/user.ts'
import { useRouter } from 'vue-router'
import { userRegister, userLogin } from '@/api/userController'
import { message } from 'ant-design-vue'

const router = useRouter()
const loginUserStore = useLoginUserStore()
// Modified to require at least 3 out of 4 character types
const passwordPattern =
  /^((?=.*[a-z])(?=.*[A-Z])(?=.*\d)|(?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9])|(?=.*[a-z])(?=.*\d)(?=.*[^A-Za-z0-9])|(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9])).*$/

const form1 = reactive<API.UserLoginRequest>({
  userAccount: '',
  userPassword: '',
})

const handleLogin = async () => {
  try {
    const res = await userLogin(form1)
    if (res.data.code === 0 && res.data.data) {
      await loginUserStore.fetchLoginUser()
      message.success('ç™»å½•æˆåŠŸ')
      router.push({
        path: '/',
        replace: true,
      })
    } else {
      message.error('ç™»å½•å¤±è´¥: ' + (res.data.description || 'æœªçŸ¥é”™è¯¯'))
    }
  } catch (error) {
    message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
    console.error('Login error:', error)
  }
}

const form2 = reactive<API.UserRegisterRequest>({
  userAccount: '',
  userPassword: '',
  checkPassword: '',
})

const handleRegister = async () => {
  if (form2.checkPassword !== form2.userPassword) {
    message.error('äºŒæ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´')
    return
  }

  try {
    const res = await userRegister(form2)
    if (res.data.code === 0 && res.data.data) {
      message.success('æ³¨å†ŒæˆåŠŸ')
      // Reset form after successful registration
      Object.assign(form2, {
        userAccount: '',
        userPassword: '',
        checkPassword: '',
      })
      disfiex.value = 0
    } else {
      message.error('æ³¨å†Œå¤±è´¥: ' + (res.data.description || 'æœªçŸ¥é”™è¯¯'))
    }
  } catch (error) {
    message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
    console.error('Registration error:', error)
  }
}

const disfiex = ref(0)
const overlaylong = ref('overlaylong')
const overlaytitle = ref('overlaytitle')

const Signin = () => {
  overlaylong.value = 'overlaylongleft'
  overlaytitle.value = 'overlaytitleright'
  disfiex.value = 1
}

const Signup = () => {
  overlaylong.value = 'overlaylongright'
  overlaytitle.value = 'overlaytitleleft'
  disfiex.value = 0
}
</script>

<style scoped>
body,
html {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.center {
  height: 88vh;
  background-image: url('https://gd-hbimg.huaban.com/9165dc3c0f8279ae5402d1f47212847bff68b49f3cb547-QEli8R');
  background-size: 100% 100%;
  background-repeat: no-repeat;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

h1 {
  font-size: 30px;
  color: black;
}

.logon {
  background-color: #fff;
  border-radius: 10px;
  box-shadow:
    0 14px 28px rgba(0, 0, 0, 0.25),
    0 10px 10px rgba(0, 0, 0, 0.22);
  /* position: relative;
  overflow: hidden; */
  width: 768px;
  max-width: 100%;
  min-height: 480px;
  margin-top: 20px;
  display: flex;
  background: -webkit-linear-gradient(right, #4284db, #29eac4);
}

.overlaylong {
  border-radius: 10px 0 0 10px;
  width: 50%;
  height: 100%;
  background-color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
}

.overlaylongleft {
  border-radius: 0px 10px 10px 0px;
  width: 50%;
  height: 100%;
  background-color: #fff;
  transform: translateX(100%);
  transition: transform 0.6s ease-in-out;
  display: flex;
  align-items: center;
  justify-content: center;
}

.overlaylongright {
  border-radius: 10px 0 0 10px;
  width: 50%;
  height: 100%;
  background-color: #fff;
  transform: translateX(0%);
  transition: transform 0.6s ease-in-out;
  display: flex;
  align-items: center;
  justify-content: center;
}

.overlaytitle {
  border-radius: 0px 10px 10px 0px;
  width: 50%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0);
  display: flex;
  align-items: center;
  justify-content: center;
}

.overlaytitleH2 {
  font-size: 30px;
  color: #fff;
  margin-top: 20px;
}

.overlaytitleP {
  font-size: 15px;
  color: #fff;
  margin-top: 20px;
}

.overlaytitleleft {
  border-radius: 0px 10px 10px 0px;
  width: 50%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0);
  display: flex;
  align-items: center;
  justify-content: center;
  transform: translateX(0%);
  transition: transform 0.6s ease-in-out;
}

.overlaytitleright {
  border-radius: 0px 10px 10px 0px;
  width: 50%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0);
  display: flex;
  align-items: center;
  justify-content: center;
  transform: translateX(-100%);
  transition: transform 0.6s ease-in-out;
}

.overlaytitle-Signin {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

.overlaytitle-Signup {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

.buttongohs {
  width: 180px;
  height: 40px;
  border-radius: 50px;
  border: 1px solid #fff;
  color: #fff;
  font-size: 15px;
  text-align: center;
  line-height: 40px;
  margin-top: 40px;
}

.overlaylongH2 {
  font-size: 25px;
  color: black;
  /* width: 250px; */
}

.overlaylong-Signin {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

.overlaylong-Signup {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

h3 {
  font-size: 10px;
  margin-top: 10px;
  cursor: pointer;
}
.inupbutton {
  background-color: #29eac4;
  border: none;
  width: 180px;
  height: 40px;
  border-radius: 50px;
  font-size: 15px;
  color: #fff;
  text-align: center;
  line-height: 30px;
  margin-top: 30px;
}
</style>

```

### ç”¨æˆ·æ³¨é”€

ä¸€èˆ¬é¼ æ ‡æ‚¬æµ®åœ¨å³ä¸Šè§’ç”¨æˆ·å¤´åƒæ—¶ï¼Œä¼šå±•ç¤ºåŒ…å«ç”¨æˆ·æ³¨é”€ï¼ˆé€€å‡ºç™»å½•ï¼‰åŠŸèƒ½çš„ä¸‹æ‹‰èœå•ã€‚

```vue
<div v-if="loginUserStore.loginUser.id">
          <a-dropdown>
            <a-space>
              <a-avatar :src="loginUserStore.loginUser.userAvatar" />
              {{ loginUserStore.loginUser.userName ?? 'æ— å' }}
            </a-space>
            <template #overlay>
              <a-menu>
                <a-menu-item @click="doLogout">
                  <LogoutOutlined />
                  é€€å‡ºç™»å½•
                </a-menu-item>
              </a-menu>
            </template>
          </a-dropdown>
        </div>
```

### ä¸ªäººä¸­å¿ƒ

#### 1. æ–°å»ºè·¯ç”±

```ts
routes: [
    {
      path: '/',
      name: 'home',
      component: HomePage,
    },
    {
      path: '/user/login',
      name: 'ç”¨æˆ·ç™»å½•',
      component: UserLoginPage,
    },
    {
      path: '/user/center',
      name: 'ä¸ªäººä¸­å¿ƒ',
      component: UserProfilePage,
    },
    {
      path: '/admin/userManage',
      name: 'ç”¨æˆ·ç®¡ç†',
      component: UserManagePage,
    },
  ],
```

#### 2. é¡µé¢è·³è½¬

```vue
                <a-menu-item @click="goUserCenter">
                  <UserOutlined />
                  ä¸ªäººä¸­å¿ƒ
                </a-menu-item>
```

è·³è½¬å‡½æ•°

```ts
const goUserCenter = async () => {
  await router.push('/user/center')
}
```

### ç”¨æˆ·ç®¡ç†

éœ€æ±‚ï¼šå…è®¸ç®¡ç†å‘˜æŸ¥çœ‹å·²æ³¨å†Œçš„ç”¨æˆ·ä¿¡æ¯ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·åç§°æœç´¢ç”¨æˆ·ã€å¹¶åˆ é™¤éæ³•ç”¨æˆ·ã€‚
éœ€è¦æ³¨æ„ï¼Œè¦é˜²æ­¢æ™®é€šç”¨æˆ·ä¹Ÿèƒ½çœ‹åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥è¦å¢åŠ ä¸€å®šçš„æƒé™æ§åˆ¶ï¼Œå¯ä»¥åˆ†ä¸ºé¡µé¢å¼€å‘å’Œæƒé™æ§åˆ¶ä¸¤ä¸ªæ­¥éª¤æ¥å®ç°ã€‚
ç¼–å†™é¡µé¢ï¼šä¸Šæ–¹æœç´¢æ ï¼Œä¸‹æ–¹è¡¨æ ¼ï¼Œè¡¨æ ¼éœ€è¦æ”¯æŒåˆ†é¡µã€‚
æˆ‘ä»¬å¯ä»¥æ‹†åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤æ¥å¼€å‘ï¼š

#### 1. è¡¨æ ¼

1. åˆ©ç”¨Ant Design Vueçš„è¡¨æ ¼ç»„ä»¶ï¼Œæ‰¾åˆ°éœ€è¦çš„ç»„ä»¶è¿›è¡Œå¤åˆ¶ï¼Œå…ˆå±•ç¤ºå…¨éƒ¨ç”¨æˆ·ä¿¡æ¯ã€‚

![image-20250729163531220](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729163531220.webp)

2. åªéœ€è¦æ ¹æ®è‡ªå·±çš„æ•°æ®è¡¨ï¼Œç¼–å†™columnsè¡¨æ ¼åˆ—ï¼Œå¹¶ä¼ å…¥è·å–åˆ°çš„dataæ•°æ®ï¼Œç»„ä»¶å°±èƒ½è‡ªåŠ¨å¸®æˆ‘ä»¬å±•ç¤ºå‡ºè¡¨æ ¼ï¼Œéå¸¸æ–¹ä¾¿ã€‚
   å®šä¹‰è¡¨æ ¼åˆ—ï¼š

```ts
const columns = [
  {
    title: 'id',
    dataIndex: 'id',
  },
  {
    title: 'è´¦å·',
    dataIndex: 'userAccount',
  },
  {
    title: 'ç”¨æˆ·å',
    dataIndex: 'userName',
  },
  {
    title: 'å¤´åƒ',
    dataIndex: 'userAvatar',
  },
  {
    title: 'ç®€ä»‹',
    dataIndex: 'userProfile',
  },
  {
    title: 'ç”¨æˆ·è§’è‰²',
    dataIndex: 'userRole',
  },
  {
    title: 'åˆ›å»ºæ—¶é—´',
    dataIndex: 'createTime',
  },
  {
    title: 'æ“ä½œ',
    key: 'action',
  },
]

```

3. ä»åç«¯è·å–æ•°æ®

```ts
// æ•°æ®
const data = ref<API.UserVO[]>([])
const total = ref(0)

// æœç´¢æ¡ä»¶
const searchParams = reactive<API.UserQueryRequest>({
  pageNum: 1,
  pageSize: 10,
})

// è·å–æ•°æ®
const fetchData = async () => {
  const res = await listUserVoByPage({
    ...searchParams,
  })
  if (res.data.data) {
    data.value = res.data.data.records ?? []
    total.value = res.data.data.totalRow ?? 0
  } else {
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)
  }
}

// é¡µé¢åŠ è½½æ—¶è¯·æ±‚ä¸€æ¬¡
onMounted(() => {
  fetchData()
})

```

![image-20250729164021440](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729164021440.webp)

æŸ¥çœ‹é¡µé¢ï¼Œå¥‡ä¸‘æ— æ¯”ï¼Œæ¥ä¸‹æ¥è¿›è¡Œä¼˜åŒ–

4. å¯¹äºå›¾ç‰‡ã€ç”¨æˆ·è§’è‰²ã€åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ä¹‹ç±»çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ›´å¥½çš„å±•ç¤ºæ–¹å¼

è¡¨æ ¼ç»„ä»¶æ”¯æŒæˆ‘ä»¬ä½¿ç”¨Vueçš„æ’æ§½è‡ªå®šä¹‰åˆ—çš„å±•ç¤ºï¼Œå‚è€ƒDemoæœ‰æ ·å­¦æ ·ä¿®æ”¹å³å¯ã€‚

```vue
<template #bodyCell="{ column, record }">
  <template v-if="column.dataIndex === 'userAvatar'">
    <a-image :src="record.userAvatar" :width="120" />
  </template>
  <template v-else-if="column.dataIndex === 'userRole'">
    <div v-if="record.userRole === 'admin'">
      <a-tag color="green">ç®¡ç†å‘˜</a-tag>
    </div>
    <div v-else>
      <a-tag color="blue">æ™®é€šç”¨æˆ·</a-tag>
    </div>
  </template>
  <template v-else-if="column.dataIndex === 'createTime'">
    {{ dayjs(record.createTime).format('YYYY-MM-DD HH:mm:ss') }}
  </template>
  <template v-else-if="column.key === 'action'">
    <a-button danger>åˆ é™¤</a-button>
  </template>
</template>

```

![image-20250729164252173](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729164252173.webp)

#### 2.åˆ†é¡µ

1. è¡¨æ ¼ç»„ä»¶æ”¯æŒåˆ†é¡µï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ªåˆ†é¡µå˜é‡ï¼ŒæŒ‡å®šå½“å‰é¡µå·ã€é¡µé¢å¤§å°ã€æ•°æ®æ€»æ•°ã€å±•ç¤ºæ€»æ•°çš„æ–‡æ¡ˆç­‰å‚æ•°ï¼š

```ts
// åˆ†é¡µå‚æ•°
const pagination = computed(() => {
  return {
    current: searchParams.pageNum ?? 1,
    pageSize: searchParams.pageSize ?? 10,
    total: total.value,
    showSizeChanger: true,
    showTotal: (total: number) => `å…± ${total} æ¡`,
  }
})
```

2. ç¼–å†™doTableChangeå‡½æ•°ï¼Œå½“ç”¨æˆ·åˆ‡æ¢é¡µå·å’Œé¡µé¢å¤§å°æ—¶ï¼Œéœ€è¦æ›´æ–°searchParamsæœç´¢æ¡ä»¶çš„å€¼ï¼Œå¹¶è§¦å‘æœç´¢ï¼š

```ts
// è¡¨æ ¼å˜åŒ–å¤„ç†
const doTableChange = (page: any) => {
  searchParams.pageNum = page.current
  searchParams.pageSize = page.pageSize
  fetchData()
}
```

3. ç»™è¡¨æ ¼ç»„ä»¶ç»‘å®šåˆ†é¡µå‚æ•°å’Œè¡¨æ ¼åˆ‡æ¢äº‹ä»¶ï¼š

```ts
<a-table
  :columns="columns"
  :data-source="data"
  :pagination="pagination"
  @change="doTableChange"
>
```

![image-20250729164642274](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250729164642274.webp)

#### 3.æœç´¢

åˆ©ç”¨Ant Design Vueçš„æœç´¢ç»„ä»¶ï¼Œå®ç°å¯¹æ•°æ®çš„æœç´¢ã€‚

1. å…¶å®æœç´¢æœ¬è´¨ä¸Šå°±æ˜¯è®©ç”¨æˆ·å¡«å†™æœç´¢æ¡ä»¶è¡¨å•ï¼Œæ­¤å¤„æˆ‘ä»¬éœ€è¦æ ¹æ®è´¦å·å’Œç”¨æˆ·å‘¢ç§°æœç´¢ï¼Œç¼–å†™è¡¨å•ä»£ç ï¼š

```vue
```

ä½¿ç”¨searchParamsæ¥å—ç”¨æˆ·çš„è¾“å…¥ï¼Œç›¸å½“äºæ‰€æœ‰çš„æœç´¢æ¡ä»¶å…¨éƒ¨å­˜åˆ°äº†searchParamsä¸­ï¼Œä¾¿äºç»Ÿä¸€ç»´æŠ¤

2. ç‚¹å‡»æœç´¢æŒ‰é’®æ—¶ä¼šè§¦å‘è¡¨å•æäº¤ï¼Œè¡¨å•æäº¤æ—¶éœ€è¦å°†é¡µå·é‡ç½®ä¸º1ï¼Œå¹¶è·å–æ•°æ®ã€‚ç¼–å†™å¯¹åº”çš„å‡½æ•°ï¼š

#### 4. åˆ é™¤

æ¯”å¦‚å¼€å‘åˆ é™¤åŠŸèƒ½ï¼Œå…ˆç¼–å†™ç‚¹å‡»åˆ é™¤æŒ‰é’®åçš„å¤„ç†å‡½æ•°ï¼š

```ts
// åˆ é™¤æ•°æ®
const doDelete = async (id: string) => {
  if (!id) {
    return
  }
  const res = await deleteUser({ id })
  if (res.data.code === 0) {
    message.success('åˆ é™¤æˆåŠŸ')
    // åˆ·æ–°æ•°æ®
    fetchData()
  } else {
    message.error('åˆ é™¤å¤±è´¥')
  }
}

```

ç„¶åç»˜åˆ é™¤æŒ‰é’®é‚¦å®šäº‹ä»¶ï¼š

```ts
<a-button danger @click="doDelete(record.id)">åˆ é™¤</a-button>
```

### ç”¨æˆ·æƒé™æ§åˆ¶

è™½ç„¶åç«¯è·å–ç”¨æˆ·åˆ—è¡¨çš„æ¥å£åšäº†æƒé™æ ¡éªŒï¼Œé˜²æ­¢éç®¡ç†å‘˜ç”¨æˆ·è·å–åˆ°ã€‚ä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿå®‰å…¨å’Œæå‡ç”¨æˆ·ä½“éªŒï¼Œå‰ç«¯ä¹Ÿéœ€è¦å¯¹æƒé™è¿›è¡Œæ§åˆ¶ã€‚
æœ‰2ç§å®ç°æ–¹å¼ï¼šå•é¡µé¢æ§åˆ¶æƒé™ï¼Œæˆ–è€…å…¨å±€æ§åˆ¶æƒé™ã€‚

æ€è·¯éƒ½æ˜¯ä¸€è‡´çš„ï¼Œåœ¨è¿›å…¥æŸä¸ªé¡µé¢æ—¶åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…·æœ‰è¯¥é¡µé¢çš„æƒé™ï¼Œæ— éæ˜¯æŠŠæƒé™æ ¡éªŒç›¸å…³çš„ä»£ç å†™åœ¨å•ä¸ªé¡µé¢å†…ï¼Œåªæ˜¯å†™åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ç½¢äº†ã€‚
*å»ºè®®ç¼–å†™ç‹¬ç«‹çš„å…¨å±€æƒé™æ§åˆ¶æ–‡ä»¶ã€‚*å¯ä»¥åˆ©ç”¨Vue Routerçš„è·¯ç”±å®ˆå«å®ç°ï¼Œæ¯æ¬¡åˆ‡æ¢å¹¶è¿›å…¥é¡µé¢å‰ï¼Œéƒ½ä¼šæ£€æŸ¥ä¸€ä¸‹å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰ç‰¹å®šé¡µé¢çš„æƒé™ã€‚
åœ¨srcä¸‹ç¼–å†™access..tsæƒé™æ ¡éªŒæ–‡ä»¶ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰é€»è¾‘ï¼Œæ¯”å¦‚ç”¨é¡µé¢å‰ç¼€æ¥ç»Ÿä¸€åˆ¤æ–­ï¼š

```ts
import { useLoginUserStore } from '@/stores/user.ts'
import { message } from 'ant-design-vue'
import router from '@/router'

// æ˜¯å¦ä¸ºé¦–æ¬¡è·å–ç™»å½•ç”¨æˆ·
let firstFetchLoginUser = true

/**
 * å…¨å±€æƒé™æ ¡éªŒ
 */
router.beforeEach(async (to, from, next) => {
  const loginUserStore = useLoginUserStore()
  let loginUser = loginUserStore.loginUser
  // ç¡®ä¿é¡µé¢åˆ·æ–°ï¼Œé¦–æ¬¡åŠ è½½æ—¶ï¼Œèƒ½å¤Ÿç­‰åç«¯è¿”å›ç”¨æˆ·ä¿¡æ¯åå†æ ¡éªŒæƒé™
  if (firstFetchLoginUser) {
    await loginUserStore.fetchLoginUser()
    loginUser = loginUserStore.loginUser
    firstFetchLoginUser = false
  }
  const toUrl = to.fullPath
  if (toUrl.startsWith('/admin')) {
    if (!loginUser || loginUser.userRole !== 'admin') {
      message.error('æ²¡æœ‰æƒé™')
      next(`/user/login?redirect=${to.fullPath}`)
      return
    }
  }
  next()
})
```

æ³¨æ„ï¼Œä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†ç¡®ä¿é¡µé¢åˆ·æ–°æ—¶ï¼Œä»åç«¯æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯åå†è¿›è¡Œæƒé™æ ¡éªŒï¼Œä½¿ç”¨awitç­‰å¾…åç«¯æ¥å£è¿”å›ï¼Œå¹¶é‡æ–°èµ‹å€¼ç»™loginUserã€‚åŒæ—¶ï¼Œä¸ºäº†é˜²æ­¢æ¯æ¬¡åˆ‡æ¢è·¯ç”±éƒ½ä»è¿œç¨‹è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå®šä¹‰äº†firstFetchLoginUserå˜é‡ï¼Œç”¨äºæ§åˆ¶åœ¨åˆ·æ–°é¡µé¢ååªä¼šè¯·æ±‚åç«¯ä¸€æ¬¡ã€‚
ç”±äºåœ¨access.tsä¸­å·²ç»è·å–åˆ°äº†ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œå¯ä»¥ç§»é™¤æ‰ä¹‹å‰åœ¨App.vueä¸­è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯çš„é€»è¾‘ï¼Œé¿å…é‡å¤è¯·æ±‚ã€‚

```ts
import '@/access'
```

è™½ç„¶å·²ç»æ»¡è¶³äº†éœ€æ±‚ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼Œå…¶å®ä¸åº”è¯¥çœ‹åˆ°"ç”¨æˆ·ç®¡ç†â€èœå•ã€‚å› æ­¤æˆ‘ä»¬è¿˜è¦ä¿®æ”¹GlobalHeaderèœå•é¡¹é…ç½®ï¼Œæ ¹æ®æƒé™å†³å®šæ˜¯å¦å±•ç¤ºæŸäº›èœå•é¡¹ã€‚
ç¼–å†™ä¸€ä¸ªè¿‡æ»¤èœå•é¡¹çš„å‡½æ•°ï¼š

```ts
// èœå•é…ç½®é¡¹
const originItems = [
  {
    key: '/',
    icon: () => h(HomeOutlined),
    label: 'ä¸»é¡µ',
    title: 'ä¸»é¡µ',
  },
  {
    key: '/admin/userManage',
    label: 'ç”¨æˆ·ç®¡ç†',
    title: 'ç”¨æˆ·ç®¡ç†',
  },
  {
    key: 'others',
    label: h('a', { href: 'https://www.codefather.cn', target: '_blank' }, 'ç¼–ç¨‹å¯¼èˆª'),
    title: 'ç¼–ç¨‹å¯¼èˆª',
  },
]

// è¿‡æ»¤èœå•é¡¹
const filterMenus = (menus = [] as MenuProps['items']) => {
  return menus?.filter((menu) => {
    const menuKey = menu?.key as string
    if (menuKey?.startsWith('/admin')) {
      const loginUser = loginUserStore.loginUser
      if (!loginUser || loginUser.userRole !== 'admin') {
        return false
      }
    }
    return true
  })
}

// å±•ç¤ºåœ¨èœå•çš„è·¯ç”±æ•°ç»„
const menuItems = computed<MenuProps['items']>(() => filterMenus(originItems))

```


[toc]

# å¯è§†åŒ–ä¿®æ”¹

è¿™é‡Œç»§ç»­å¯¹aiåº”ç”¨ç”Ÿæˆå¹³å°åŠŸèƒ½è¿›è¡Œæ‰©å±•â€”â€”å¯è§†åŒ–ä¿®æ”¹ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡ç‚¹å‡»é€‰æ‹©ç½‘é¡µå…ƒç´ ï¼Œç»“åˆ
æç¤ºè¯æ¥ç²¾ç¡®ä¿®æ”¹ç”Ÿæˆçš„ç½‘ç«™åº”ç”¨ï¼Œæ›´ç›´è§‚åœ°å¯¹ç”Ÿæˆçš„ç½‘ç«™è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶ã€‚

ä¸»è¦å†…å®¹ï¼š

- å¯è§†åŒ–ç¼–è¾‘æ–¹æ¡ˆè®¾è®¡
- å‰ç«¯å…ƒç´ é€‰æ‹©ä¸é€šä¿¡æœºåˆ¶
- åŸç”Ÿåº”ç”¨å…¨é‡ä¿®æ”¹
- å·¥ç¨‹é¡¹ç›®å¢é‡ä¿®æ”¹

## éœ€æ±‚åˆ†æ

æˆ‘ä»¬å®ç°äº†å¯¹è¯å†å²å’Œè®°å¿†åŠŸèƒ½ï¼ŒA!å·²ç»èƒ½å¤ŸåŸºäºå†å²ä¸Šä¸‹æ–‡è¿›è¡Œç½‘ç«™çš„è¿­ä»£ä¼˜åŒ–ã€‚ä½†æ˜¯ç”¨æˆ·åœ¨ä¿®æ”¹ç½‘
ç«™æ—¶ï¼Œä»ç„¶éœ€è¦é€šè¿‡æ–‡å­—æè¿°æ¥å‘Šè¯‰A!è¦ä¿®æ”¹å“ªä¸ªéƒ¨åˆ†ï¼Œå¦‚æœæè¿°ä¸æ¸…æ¥šï¼ŒAå¯èƒ½å°±ä¼šä¿®æ”¹é”™è¯¯ã€æˆ–è€…é€ æˆé¢å¤–çš„ä¿®æ”¹ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œç”¨æˆ·ç”Ÿæˆäº†ä¸€ä¸ªåŒ…å«å¤šä¸ªå¡ç‰‡çš„ç½‘ç«™ï¼Œç°åœ¨æƒ³è¦ä¿®æ”¹å…¶ä¸­æŸä¸€ä¸ªå¡ç‰‡çš„æ ‡é¢˜ã€‚å¦‚æœåªæ˜¯è¯´"ä¿®æ”¹å¡ç‰‡æ ‡é¢˜â€ï¼ŒAIå¯èƒ½ä¸çŸ¥é“è¦ä¿®æ”¹å“ªä¸ªå¡ç‰‡ã€‚å³ä½¿ç”¨æˆ·è¯¦ç»†æè¿°"ä¿®æ”¹ç¬¬äºŒä¸ªå¡ç‰‡çš„æ ‡é¢˜â€ï¼ŒA!ä¹Ÿæœ‰å¯èƒ½ç†è§£é”™è¯¯ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®ç°å¯è§†åŒ–ä¿®æ”¹åŠŸèƒ½ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿç›´æ¥ç‚¹å‡»ç½‘é¡µä¸Šçš„å…ƒç´ ï¼Œç„¶åè¾“å…¥ä¿®æ”¹éœ€æ±‚ï¼ŒAIå°±èƒ½ç²¾ç¡®çŸ¥é“è¦ä¿®æ”¹çš„æ˜¯å“ªä¸ªéƒ¨åˆ†ã€‚

## æ–¹æ¡ˆè®¾è®¡

é€šè¿‡å¯¹NoCodeå’Œç§’å“’çš„åˆ†æï¼Œæˆ‘æ€»ç»“äº†å‡ ä¸ªå…³é”®å‘ç°ï¼š

1. æ‰‹åŠ¨ç¼–è¾‘çš„å¼€å‘æˆæœ¬å¤ªé«˜ã€‚å¦‚æœè¦è¿½æ±‚è‰¯å¥½çš„æ•ˆæœï¼Œéœ€è¦å‰ç«¯å¼€å‘å®Œæ•´çš„å¯è§†åŒ–ä»£ç ç¼–è¾‘å™¨ï¼Œå¹¶ä¸”è¿˜è¦ä»é›¶å¼€å§‹çº¦å®šä¸€å¥—DSLè§„èŒƒï¼Œè®©ä»£ç èƒ½å¤Ÿå‡†ç¡®ä¿®æ”¹ã€‚è¿™ä¸ªè¿‡ç¨‹å‘ç‚¹å·¨å¤§ï¼Œå¯¹æˆ‘ä»¬çš„é¡¹ç›®æ¥è¯´æœ‰äº›æœ¬æœ«å€’ç½®ã€‚
2. æ²¡æœ‰å¿…è¦ä¼ é€’å¤§é‡çš„å‚æ•°ã€‚ç¾å›¢æ˜¯å°†æ‰€æœ‰æ–‡ä»¶éƒ½ä¼ ç»™åç«¯ï¼Œè¿™ç§åšæ³•è™½ç„¶ä¿é™©ï¼Œä½†ä¼šé€ æˆç½‘ç»œä¼ è¾“å’Œå¤„ç†çš„æµªè´¹ï¼Œæ¯•ç«Ÿæˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¤§å‚çº§åˆ«çš„æœåŠ¡å™¨ã€‚
3. æ— è®ºå“ªç§ç¼–è¾‘æ–¹æ¡ˆï¼Œéƒ½éœ€è¦è·å–è¢«ä¿®æ”¹çš„å…ƒç´ ä¿¡æ¯ï¼Œä½†ä¸å»ºè®®è·å–å…·ä½“çš„ä»£ç ä½ç½®ã€‚ç‰¹åˆ«æ˜¯å¯¹äºæ‰“åŒ…ç±»çš„Vueå·¥ç¨‹ï¼Œå¾ˆéš¾ç²¾ç¡®è·å–å…ƒç´ åœ¨æºç ä¸­çš„ä½ç½®ï¼Œå®¹æ˜“å‡ºç°Bugã€‚

åŸºäºè¿™äº›ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡å‡ºè‡ªå·±çš„å®ç°æ–¹æ¡ˆï¼šé‡ç‚¹å¼€å‘**å¯è§†åŒ–é€‰æ‹©åŠ AIæç¤ºè¯ç¼–è¾‘çš„æ¨¡å¼ã€‚**

å…·ä½“æµç¨‹æ˜¯ï¼š

1. ç”¨æˆ·å¼€å¯ç¼–è¾‘æ¨¡å¼ï¼Œé€‰ä¸­ç½‘é¡µå…ƒç´ 
2. å‰ç«¯è·å–ç”¨æˆ·é€‰ä¸­çš„å…ƒç´ ä¿¡æ¯ï¼Œå°†å…¶å…³è”åˆ°æç¤ºè¯ä¸­ï¼Œå¹¶å‘é€ç»™åç«¯
3. åç«¯è°ƒç”¨A!è¿›è¡Œä¿®æ”¹ï¼Œè®©A!è‡ªå·±åˆ¤æ–­å¦‚ä½•ä¿®æ”¹å¹¶è¿”å›ç»“æœã€‚

è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ›´ç®€å•ã€å¥½ç†è§£ï¼Œç¼ºç‚¹æ˜¯å‡†ç¡®åº¦å¯èƒ½æœ‰é™ï¼Œå…¶å®å°±æ˜¯å¼€å‘æˆæœ¬å’Œæ•ˆæœçš„ç»¼åˆæƒè¡¡äº†ã€‚

### é€‰ä¸­ç½‘é¡µå…ƒç´ æ–¹æ¡ˆ

æˆ‘ä»¬ç›®å‰æ˜¯é€šè¿‡åœ¨å‰ç«¯é¡µé¢å†…åµŒiframeæ¥å®ç°å®æ—¶é¢„è§ˆã€‚ç°åœ¨éœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šå®ç°ä¸€ä¸ªæ–°åŠŸèƒ½ï¼šå½“ç‚¹å‡»iframeä¸­çš„å…ƒç´ æ—¶ï¼Œå°†è¢«ç‚¹å‡»å…ƒç´ çš„ä¿¡æ¯ä¸ŠæŠ¥ç»™çˆ¶ç½‘ç«™ã€‚

è¿™ç›¸å½“äºå­ç½‘ç«™è¦æ·»åŠ é€»è¾‘ï¼Œå±•ç¤ºé¼ æ ‡åœ¨å…ƒç´ ä¸Šæ‚¬æµ®çš„æ•ˆæœï¼Œå¹¶ä¸”ç‚¹å‡»å…ƒç´ åï¼Œå‘Šè¯‰çˆ¶ç½‘ç«™å…ƒç´ ä¿¡æ¯ã€‚

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨postMessageå®ç°å­çˆ¶ç½‘ç«™é€šä¿¡ã€‚éœ€è¦åœ¨å­ç½‘ç«™çš„JSæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œæ³¨å…¥æƒ…æŠ¥ä¸ŠæŠ¥é€»è¾‘ï¼š

```javascript
document.addEventListener('click', (event) => {
  const selectedElement = event.target;
  if (selectedElement) {
    // æ‰¾åˆ°äº†æºç ä½ç½®ï¼Œå‘ä¸»é¡µé¢æ±‡æŠ¥ï¼
    window.parent.postMessage({
      type: 'element-selected',
      payload: {
        data: selectedElement
      }
    }, '*'); // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåº”æŒ‡å®šç¡®åˆ‡çš„ç›®æ ‡æº
  }
}, true); // ä½¿ç”¨æ•è·é˜¶æ®µä»¥ç¡®ä¿ç›‘å¬åˆ°æ‰€æœ‰ç‚¹å‡»äº‹ä»¶
```

çˆ¶ç½‘ç«™é€šè¿‡ä»¥ä¸‹ä»£ç æ¥æ”¶å¹¶å¤„ç†ï¼š

```javascript
const handleIframeMessage = (event: MessageEvent) => {
  const data = event.data
  // å¢åŠ å¥å£®æ€§ï¼šç¡®ä¿ data æ˜¯ä¸€ä¸ªå¯¹è±¡ä¸”åŒ…å« selector å±æ€§ï¼Œå¹¶ä¸” selector æ˜¯å­—ç¬¦ä¸²
  if (data && typeof data === 'object' && data.type === 'element-selected') {
    console.log('æ¥æ”¶åˆ°æ–°çš„å…ƒç´ ä½ç½®:', data.payload)
    selectedElementLocation.value = data.payload.data
  }
}
```

æ¥æ”¶åˆ°è¿™äº›æ•°æ®åï¼Œå°±å¯ä»¥æ‹¼æ¥æç¤ºè¯ç„¶åä¼ é€’ç»™åç«¯äº†ã€‚

ä½†é—®é¢˜æ˜¯å­ç½‘ç«™æ˜¯æå‰ç”Ÿæˆå¥½çš„ï¼Œæ€ä¹ˆå¢åŠ postMessageç›¸å…³çš„ä»£ç å‘¢ï¼Ÿè¿™é‡Œæœ‰2ç§å…·ä½“çš„æ–¹æ¡ˆã€‚

#### æ–¹æ¡ˆ1-æå‰ç”Ÿæˆä»£ç 

ç›´æ¥ä¿®æ”¹AIçš„æç¤ºè¯ã€æˆ–è€…ä¿®æ”¹Alç”Ÿæˆçš„JSæ–‡ä»¶ï¼Œæ·»åŠ ä¸Šè¿°postMessageä»£ç ã€‚

è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å­çˆ¶ç½‘ç«™å¯ä»¥ä¸åŒæºï¼Œæ›´çµæ´»ã€‚ä½†æ˜¯ä¿®æ”¹AIç”Ÿæˆçš„ä»£ç å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œæ¯•ç«Ÿä»£ç æ˜¯å¯ä»¥ç»™æˆ·ä¸‹è½½çš„ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä¿è¯ç”Ÿæˆä»£ç çš„çº¯å‡€æ€§ã€‚

**ä»€ä¹ˆæ˜¯åŒæºï¼Ÿ**

æµè§ˆå™¨çš„åŒæºç­–ç•¥(Same-Origin Policy).è§„å®šï¼Œä¸¤ä¸ªé¡µé¢è‹¥è¦è¢«è§†ä¸ºâ€œåŒæºâ€ï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸‹3ä¸ªæ¡ä»¶ï¼š

1. åè®®ç›¸åŒã€‚å¦‚éƒ½æ˜¯httpæˆ–https
2. åŸŸåç›¸åŒã€‚å¦‚éƒ½æ˜¯chengfu.cn;åŒ…æ‹¬å­åŸŸåæ˜¯å¦ä¸€è‡´.
3. ç«¯å£ç›¸åŒã€‚è‹¥æœªæŒ‡å®šç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º8o(http)æˆ–443(https)

#### æ–¹æ¡ˆ2-åŠ¨æ€æ³¨å…¥ä»£ç 

åœ¨è¿›å…¥å¯è§†åŒ–ç¼–è¾‘æ¨¡å¼æ—¶ï¼Œçˆ¶ç½‘ç«™åŠ¨æ€åœ°ç»™å­ç½‘ç«™æ³¨å…¥ä»£ç ã€‚ä½†æ˜¯è¦æ±‚å­çˆ¶ç½‘ç«™å¿…é¡»åŒæºï¼

é€šè¿‡åœ¨å‰ç«¯é…ç½®ä»£ç†ï¼Œå¯ä»¥è®©å­ç½‘ç«™å’Œçˆ¶ç½‘ç«™åŒæºã€‚

æœ¬åœ°å¯ä»¥ä½¿ç”¨Viteé…ç½®å¯¹åç«¯æ¥å£çš„ä»£ç†ï¼ˆçº¿ä¸Šå¯ä»¥ç”¨Nginx),ä¿®æ”¹`vite.config.ts`:

```javascript
// https://vite.dev/config/
export default defineConfig({
  plugins: [vue(), vueDevTools()],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url)),
    },
  },
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8123',
        changeOrigin: true,
        secure: false,
      },
    },
  },
})
```

ä¿®æ”¹ç¯å¢ƒé…ç½®`.env.development`ä¸­æœ¬åœ°è¯·æ±‚åç«¯çš„åœ°å€ä¸ºç›¸å¯¹ç›®å½•ï¼š

```properties
VITE_DEPLOY_DOMAIN=http://localhost

VITE_API_BASE_URL=/api
```

è¿™æ ·ä¸€æ¥ï¼Œå‰ç«¯è¯·æ±‚åç«¯æ—¶ï¼Œç”±äºæ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„ï¼Œä¼šè‡ªåŠ¨è¯·æ±‚å’Œå‰ç«¯åŸŸåç›¸åŒçš„è·¯å¾„ï¼ˆæ¯”å¦‚localhost:5173/api),
ç„¶åé€šè¿‡Vteä»£ç†åˆ°å®é™…çš„åç«¯æ¥å£åœ°å€ã€‚è¿™æ ·å°±è§£å†³äº†åŒæºé—®é¢˜ï¼Œå¯ä»¥å®ç°ä»£ç åŠ¨æ€æ³¨å…¥ï¼Œä¸ç”¨è®©AIç”Ÿæˆé¢å¤–çš„ä»£ç äº†ï¼Œæ¨èè¿™ç§æ–¹æ¡ˆã€‚

## å‰ç«¯å¼€å‘

é¦–å…ˆæˆ‘ä»¬æŒ‰ç…§æ–¹æ¡ˆ2é…ç½®Viteä»£ç†ã€å¹¶ä¸”ä¿®æ”¹ç¯å¢ƒé…ç½®ã€‚

### å¯è§†åŒ–ç¼–è¾‘

å¯è§†åŒ–ç¼–è¾‘æ–‡ä»¶è´Ÿè´£å®šä¹‰å­çˆ¶ç½‘ç«™é€šè®¯äº‹ä»¶ï¼Œç”±çˆ¶ç»„ä»¶å‘å­ç»„ä»¶æ³¨å…¥ä»£ç ã€‚è¿™ä¸ªæ–‡ä»¶æå…¶å¤æ‚ï¼Œå°è£…äº†æ‰€æœ‰ä¸å¯è§†åŒ–ç¼–è¾‘ç›¸å…³çš„é€»è¾‘ï¼ŒåŒ…æ‹¬è„šæœ¬æ³¨å…¥ã€äº‹ä»¶ç›‘å¬ã€å…ƒç´ é€‰æ‹©ç­‰åŠŸèƒ½ã€‚

```ts
/**
 * å¯è§†åŒ–ç¼–è¾‘å™¨å·¥å…·ç±»
 * è´Ÿè´£ç®¡ç†iframeå†…çš„å¯è§†åŒ–ç¼–è¾‘åŠŸèƒ½
 */
export interface ElementInfo {
  tagName: string
  id: string
  className: string
  textContent: string
  selector: string
  pagePath: string
  rect: {
    top: number
    left: number
    width: number
    height: number
  }
}

export interface VisualEditorOptions {
  onElementSelected?: (elementInfo: ElementInfo) => void
  onElementHover?: (elementInfo: ElementInfo) => void
}

export class VisualEditor {
  private iframe: HTMLIFrameElement | null = null
  private isEditMode = false
  private options: VisualEditorOptions

  constructor(options: VisualEditorOptions = {}) {
    this.options = options
  }

  /**
   * åˆå§‹åŒ–ç¼–è¾‘å™¨
   */
  init(iframe: HTMLIFrameElement) {
    this.iframe = iframe
  }

  /**
   * å¼€å¯ç¼–è¾‘æ¨¡å¼
   */
  enableEditMode() {
    if (!this.iframe) {
      return
    }
    this.isEditMode = true
    setTimeout(() => {
      this.injectEditScript()
    }, 300)
  }

  /**
   * å…³é—­ç¼–è¾‘æ¨¡å¼
   */
  disableEditMode() {
    this.isEditMode = false
    this.sendMessageToIframe({
      type: 'TOGGLE_EDIT_MODE',
      editMode: false,
    })
    // æ¸…é™¤æ‰€æœ‰ç¼–è¾‘çŠ¶æ€
    this.sendMessageToIframe({
      type: 'CLEAR_ALL_EFFECTS',
    })
  }

  /**
   * åˆ‡æ¢ç¼–è¾‘æ¨¡å¼
   */
  toggleEditMode() {
    if (this.isEditMode) {
      this.disableEditMode()
    } else {
      this.enableEditMode()
    }
    return this.isEditMode
  }

  /**
   * å¼ºåˆ¶åŒæ­¥çŠ¶æ€å¹¶æ¸…ç†
   */
  syncState() {
    if (!this.isEditMode) {
      this.sendMessageToIframe({
        type: 'CLEAR_ALL_EFFECTS',
      })
    }
  }

  /**
   * æ¸…é™¤é€‰ä¸­çš„å…ƒç´ 
   */
  clearSelection() {
    this.sendMessageToIframe({
      type: 'CLEAR_SELECTION',
    })
  }

  /**
   * iframe åŠ è½½å®Œæˆæ—¶è°ƒç”¨
   */
  onIframeLoad() {
    if (this.isEditMode) {
      setTimeout(() => {
        this.injectEditScript()
      }, 500)
    } else {
      // ç¡®ä¿éç¼–è¾‘æ¨¡å¼æ—¶æ¸…ç†çŠ¶æ€
      setTimeout(() => {
        this.syncState()
      }, 500)
    }
  }

  /**
   * å¤„ç†æ¥è‡ª iframe çš„æ¶ˆæ¯
   */
  handleIframeMessage(event: MessageEvent) {
    const { type, data } = event.data
    switch (type) {
      case 'ELEMENT_SELECTED':
        if (this.options.onElementSelected && data.elementInfo) {
          this.options.onElementSelected(data.elementInfo)
        }
        break
      case 'ELEMENT_HOVER':
        if (this.options.onElementHover && data.elementInfo) {
          this.options.onElementHover(data.elementInfo)
        }
        break
    }
  }

  /**
   * å‘ iframe å‘é€æ¶ˆæ¯
   */
  private sendMessageToIframe(message: Record<string, any>) {
    if (this.iframe?.contentWindow) {
      this.iframe.contentWindow.postMessage(message, '*')
    }
  }

  /**
   * æ³¨å…¥ç¼–è¾‘è„šæœ¬åˆ° iframe
   */
  private injectEditScript() {
    if (!this.iframe) return

    const waitForIframeLoad = () => {
      try {
        if (this.iframe!.contentWindow && this.iframe!.contentDocument) {
          // æ£€æŸ¥æ˜¯å¦å·²ç»æ³¨å…¥è¿‡è„šæœ¬
          if (this.iframe!.contentDocument.getElementById('visual-edit-script')) {
            this.sendMessageToIframe({
              type: 'TOGGLE_EDIT_MODE',
              editMode: true,
            })
            return
          }

          const script = this.generateEditScript()
          const scriptElement = this.iframe!.contentDocument.createElement('script')
          scriptElement.id = 'visual-edit-script'
          scriptElement.textContent = script
          this.iframe!.contentDocument.head.appendChild(scriptElement)
        } else {
          setTimeout(waitForIframeLoad, 100)
        }
      } catch {
        // é™é»˜å¤„ç†æ³¨å…¥å¤±è´¥
      }
    }

    waitForIframeLoad()
  }

  /**
   * ç”Ÿæˆç¼–è¾‘è„šæœ¬å†…å®¹
   */
  private generateEditScript() {
    return `
      (function() {
        let isEditMode = true;
        let currentHoverElement = null;
        let currentSelectedElement = null;

        function injectStyles() {
          if (document.getElementById('edit-mode-styles')) return;
          const style = document.createElement('style');
          style.id = 'edit-mode-styles';
          style.textContent = \`
            .edit-hover {
              outline: 2px dashed #1890ff !important;
              outline-offset: 2px !important;
              cursor: crosshair !important;
              transition: outline 0.2s ease !important;
              position: relative !important;
            }
            .edit-hover::before {
              content: '' !important;
              position: absolute !important;
              top: -4px !important;
              left: -4px !important;
              right: -4px !important;
              bottom: -4px !important;
              background: rgba(24, 144, 255, 0.02) !important;
              pointer-events: none !important;
              z-index: -1 !important;
            }
            .edit-selected {
              outline: 3px solid #52c41a !important;
              outline-offset: 2px !important;
              cursor: default !important;
              position: relative !important;
            }
            .edit-selected::before {
              content: '' !important;
              position: absolute !important;
              top: -4px !important;
              left: -4px !important;
              right: -4px !important;
              bottom: -4px !important;
              background: rgba(82, 196, 26, 0.03) !important;
              pointer-events: none !important;
              z-index: -1 !important;
            }
          \`;
          document.head.appendChild(style);
        }

        // ç”Ÿæˆå…ƒç´ é€‰æ‹©å™¨
        function generateSelector(element) {
          const path = [];
          let current = element;
          while (current && current !== document.body) {
            let selector = current.tagName.toLowerCase();
            if (current.id) {
              selector += '#' + current.id;
              path.unshift(selector);
              break;
            }
            if (current.className) {
              const classes = current.className.split(' ').filter(c => c && !c.startsWith('edit-'));
              if (classes.length > 0) {
                selector += '.' + classes.join('.');
              }
            }
            const siblings = Array.from(current.parentElement?.children || []);
            const index = siblings.indexOf(current) + 1;
            selector += ':nth-child(' + index + ')';
            path.unshift(selector);
            current = current.parentElement;
          }
          return path.join(' > ');
        }

        // è·å–å…ƒç´ ä¿¡æ¯
        function getElementInfo(element) {
          const rect = element.getBoundingClientRect();
          // è·å– HTML æ–‡ä»¶ååé¢çš„éƒ¨åˆ†ï¼ˆæŸ¥è¯¢å‚æ•°å’Œé”šç‚¹ï¼‰
          let pagePath = window.location.search + window.location.hash;
          // å¦‚æœæ²¡æœ‰æŸ¥è¯¢å‚æ•°å’Œé”šç‚¹ï¼Œåˆ™æ˜¾ç¤ºä¸ºç©º
          if (!pagePath) {
            pagePath = '';
          }

          return {
            tagName: element.tagName,
            id: element.id,
            className: element.className,
            textContent: element.textContent?.trim().substring(0, 100) || '',
            selector: generateSelector(element),
            pagePath: pagePath,
            rect: {
              top: rect.top,
              left: rect.left,
              width: rect.width,
              height: rect.height
            }
          };
        }

        // æ¸…é™¤æ‚¬æµ®æ•ˆæœ
        function clearHoverEffect() {
          if (currentHoverElement) {
            currentHoverElement.classList.remove('edit-hover');
            currentHoverElement = null;
          }
        }

        // æ¸…é™¤é€‰ä¸­æ•ˆæœ
        function clearSelectedEffect() {
          const selected = document.querySelectorAll('.edit-selected');
          selected.forEach(el => el.classList.remove('edit-selected'));
          currentSelectedElement = null;
        }

        let eventListenersAdded = false;

        function addEventListeners() {
           if (eventListenersAdded) return;

           const mouseoverHandler = (event) => {
             if (!isEditMode) return;

             const target = event.target;
             if (target === currentHoverElement || target === currentSelectedElement) return;
             if (target === document.body || target === document.documentElement) return;
             if (target.tagName === 'SCRIPT' || target.tagName === 'STYLE') return;

             clearHoverEffect();
             target.classList.add('edit-hover');
             currentHoverElement = target;
           };

           const mouseoutHandler = (event) => {
             if (!isEditMode) return;

             const target = event.target;
             if (!event.relatedTarget || !target.contains(event.relatedTarget)) {
               clearHoverEffect();
             }
           };

           const clickHandler = (event) => {
             if (!isEditMode) return;

             event.preventDefault();
             event.stopPropagation();

             const target = event.target;
             if (target === document.body || target === document.documentElement) return;
             if (target.tagName === 'SCRIPT' || target.tagName === 'STYLE') return;

             clearSelectedEffect();
             clearHoverEffect();

             target.classList.add('edit-selected');
             currentSelectedElement = target;

             const elementInfo = getElementInfo(target);
             try {
               window.parent.postMessage({
                 type: 'ELEMENT_SELECTED',
                 data: { elementInfo }
               }, '*');
             } catch {
               // é™é»˜å¤„ç†å‘é€å¤±è´¥
             }
           };

           document.body.addEventListener('mouseover', mouseoverHandler, true);
           document.body.addEventListener('mouseout', mouseoutHandler, true);
           document.body.addEventListener('click', clickHandler, true);
           eventListenersAdded = true;
         }

         function setupEventListeners() {
           addEventListeners();
         }

        // ç›‘å¬çˆ¶çª—å£æ¶ˆæ¯
        window.addEventListener('message', (event) => {
           const { type, editMode } = event.data;
           switch (type) {
             case 'TOGGLE_EDIT_MODE':
               isEditMode = editMode;
               if (isEditMode) {
                 injectStyles();
                 setupEventListeners();
                 showEditTip();
               } else {
                 clearHoverEffect();
                 clearSelectedEffect();
               }
               break;
             case 'CLEAR_SELECTION':
               clearSelectedEffect();
               break;
             case 'CLEAR_ALL_EFFECTS':
               isEditMode = false;
               clearHoverEffect();
               clearSelectedEffect();
               const tip = document.getElementById('edit-tip');
               if (tip) tip.remove();
               break;
           }
         });

         function showEditTip() {
           if (document.getElementById('edit-tip')) return;
           const tip = document.createElement('div');
           tip.id = 'edit-tip';
           tip.innerHTML = 'ğŸ¯ ç¼–è¾‘æ¨¡å¼å·²å¼€å¯<br/>æ‚¬æµ®æŸ¥çœ‹å…ƒç´ ï¼Œç‚¹å‡»é€‰ä¸­å…ƒç´ ';
           tip.style.cssText = \`
             position: fixed;
             top: 20px;
             right: 20px;
             background: #1890ff;
             color: white;
             padding: 12px 16px;
             border-radius: 6px;
             font-size: 14px;
             z-index: 9999;
             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
             animation: fadeIn 0.3s ease;
           \`;
           const style = document.createElement('style');
           style.textContent = '@keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }';
           document.head.appendChild(style);
           document.body.appendChild(tip);
           setTimeout(() => {
             if (tip.parentNode) {
               tip.style.animation = 'fadeIn 0.3s ease reverse';
               setTimeout(() => tip.remove(), 300);
             }
           }, 3000);
         }
         injectStyles();
         setupEventListeners();
         showEditTip();
      })();
    `
  }
}
```

### ä¿®æ”¹å¯¹è¯é¡µé¢

åœ¨å¯¹è¯é¡µé¢ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†é€‰ä¸­å…ƒç´ ä¿¡æ¯çš„æ˜¾ç¤ºåŒºåŸŸï¼Œä»¥åŠç¼–è¾‘å’Œé€€å‡ºç¼–è¾‘çš„æŒ‰é’®ã€‚è¿™æ ·ç”¨æˆ·å°±èƒ½æ¸…æ¥šåœ°çœ‹åˆ°å½“å‰é€‰ä¸­çš„æ˜¯å“ªä¸ªå…ƒç´ ï¼Œä¹Ÿèƒ½æ–¹ä¾¿åœ°è¿›å…¥å’Œé€€å‡ºç¼–è¾‘æ¨¡å¼ã€‚
å®Œæ•´çš„`AppChatPage.vue`ä»£ç å¦‚ä¸‹ï¼Œç›´æ¥æ›¿æ¢å°±å¥½ï¼š

```vue
<template>
  <div id="appChatPage">
    <!-- é¡¶éƒ¨æ  -->
    <div class="header-bar">
      <div class="header-left">
        <h1 class="app-name">{{ appInfo?.appName || 'ç½‘ç«™ç”Ÿæˆå™¨' }}</h1>
        <a-tag v-if="appInfo?.codeGenType" color="blue" class="code-gen-type-tag">
          {{ formatCodeGenType(appInfo.codeGenType) }}
        </a-tag>
      </div>
      <div class="header-right">
        <a-button type="default" @click="showAppDetail">
          <template #icon>
            <InfoCircleOutlined />
          </template>
          åº”ç”¨è¯¦æƒ…
        </a-button>
        <a-button
          type="primary"
          ghost
          @click="downloadCode"
          :loading="downloading"
          :disabled="!isOwner"
        >
          <template #icon>
            <DownloadOutlined />
          </template>
          ä¸‹è½½ä»£ç 
        </a-button>
        <a-button type="primary" @click="deployApp" :loading="deploying">
          <template #icon>
            <CloudUploadOutlined />
          </template>
          éƒ¨ç½²
        </a-button>
      </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
      <!-- å·¦ä¾§å¯¹è¯åŒºåŸŸ -->
      <div class="chat-section">
        <!-- æ¶ˆæ¯åŒºåŸŸ -->
        <div class="messages-container" ref="messagesContainer">
          <!-- åŠ è½½æ›´å¤šæŒ‰é’® -->
          <div v-if="hasMoreHistory" class="load-more-container">
            <a-button type="link" @click="loadMoreHistory" :loading="loadingHistory" size="small">
              åŠ è½½æ›´å¤šå†å²æ¶ˆæ¯
            </a-button>
          </div>
          <div v-for="(message, index) in messages" :key="index" class="message-item">
            <div v-if="message.type === 'user'" class="user-message">
              <div class="message-content">{{ message.content }}</div>
              <div class="message-avatar">
                <a-avatar :src="loginUserStore.loginUser.userAvatar" />
              </div>
            </div>
            <div v-else class="ai-message">
              <div class="message-avatar">
                <a-avatar :src="aiAvatar" />
              </div>
              <div class="message-content">
                <MarkdownRenderer v-if="message.content" :content="message.content" />
                <div v-if="message.loading" class="loading-indicator">
                  <a-spin size="small" />
                  <span>AI æ­£åœ¨æ€è€ƒ...</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- é€‰ä¸­å…ƒç´ ä¿¡æ¯å±•ç¤º -->
        <a-alert
          v-if="selectedElementInfo"
          class="selected-element-alert"
          type="info"
          closable
          @close="clearSelectedElement"
        >
          <template #message>
            <div class="selected-element-info">
              <div class="element-header">
                <span class="element-tag">
                  é€‰ä¸­å…ƒç´ ï¼š{{ selectedElementInfo.tagName.toLowerCase() }}
                </span>
                <span v-if="selectedElementInfo.id" class="element-id">
                  #{{ selectedElementInfo.id }}
                </span>
                <span v-if="selectedElementInfo.className" class="element-class">
                  .{{ selectedElementInfo.className.split(' ').join('.') }}
                </span>
              </div>
              <div class="element-details">
                <div v-if="selectedElementInfo.textContent" class="element-item">
                  å†…å®¹: {{ selectedElementInfo.textContent.substring(0, 50) }}
                  {{ selectedElementInfo.textContent.length > 50 ? '...' : '' }}
                </div>
                <div v-if="selectedElementInfo.pagePath" class="element-item">
                  é¡µé¢è·¯å¾„: {{ selectedElementInfo.pagePath }}
                </div>
                <div class="element-item">
                  é€‰æ‹©å™¨:
                  <code class="element-selector-code">{{ selectedElementInfo.selector }}</code>
                </div>
              </div>
            </div>
          </template>
        </a-alert>

        <!-- ç”¨æˆ·æ¶ˆæ¯è¾“å…¥æ¡† -->
        <div class="input-container">
          <div class="input-wrapper">
            <a-tooltip v-if="!isOwner" title="æ— æ³•åœ¨åˆ«äººçš„ä½œå“ä¸‹å¯¹è¯å“¦~" placement="top">
              <a-textarea
                v-model:value="userInput"
                :placeholder="getInputPlaceholder()"
                :rows="4"
                :maxlength="1000"
                @keydown.enter.prevent="sendMessage"
                :disabled="isGenerating || !isOwner"
              />
            </a-tooltip>
            <a-textarea
              v-else
              v-model:value="userInput"
              :placeholder="getInputPlaceholder()"
              :rows="4"
              :maxlength="1000"
              @keydown.enter.prevent="sendMessage"
              :disabled="isGenerating"
            />
            <div class="input-actions">
              <a-button
                type="primary"
                @click="sendMessage"
                :loading="isGenerating"
                :disabled="!isOwner"
              >
                <template #icon>
                  <SendOutlined />
                </template>
              </a-button>
            </div>
          </div>
        </div>
      </div>
      <!-- å³ä¾§ç½‘é¡µå±•ç¤ºåŒºåŸŸ -->
      <div class="preview-section">
        <div class="preview-header">
          <h3>ç”Ÿæˆåçš„ç½‘é¡µå±•ç¤º</h3>
          <div class="preview-actions">
            <a-button
              v-if="isOwner && previewUrl"
              type="link"
              :danger="isEditMode"
              @click="toggleEditMode"
              :class="{ 'edit-mode-active': isEditMode }"
              style="padding: 0; height: auto; margin-right: 12px"
            >
              <template #icon>
                <EditOutlined />
              </template>
              {{ isEditMode ? 'é€€å‡ºç¼–è¾‘' : 'ç¼–è¾‘æ¨¡å¼' }}
            </a-button>
            <a-button v-if="previewUrl" type="link" @click="openInNewTab">
              <template #icon>
                <ExportOutlined />
              </template>
              æ–°çª—å£æ‰“å¼€
            </a-button>
          </div>
        </div>
        <div class="preview-content">
          <div v-if="!previewUrl && !isGenerating" class="preview-placeholder">
            <div class="placeholder-icon">ğŸŒ</div>
            <p>ç½‘ç«™æ–‡ä»¶ç”Ÿæˆå®Œæˆåå°†åœ¨è¿™é‡Œå±•ç¤º</p>
          </div>
          <div v-else-if="isGenerating" class="preview-loading">
            <a-spin size="large" />
            <p>æ­£åœ¨ç”Ÿæˆç½‘ç«™...</p>
          </div>
          <iframe
            v-else
            :src="previewUrl"
            class="preview-iframe"
            frameborder="0"
            @load="onIframeLoad"
          ></iframe>
        </div>
      </div>
    </div>

    <!-- åº”ç”¨è¯¦æƒ…å¼¹çª— -->
    <AppDetailModal
      v-model:open="appDetailVisible"
      :app="appInfo"
      :show-actions="isOwner || isAdmin"
      @edit="editApp"
      @delete="deleteApp"
    />

    <!-- éƒ¨ç½²æˆåŠŸå¼¹çª— -->
    <DeploySuccessModal
      v-model:open="deployModalVisible"
      :deploy-url="deployUrl"
      @open-site="openDeployedSite"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, nextTick, onUnmounted, computed } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { message } from 'ant-design-vue'
import { useLoginUserStore } from '@/stores/loginUser'
import {
  getAppVoById,
  deployApp as deployAppApi,
  deleteApp as deleteAppApi,
} from '@/api/appController'
import { listAppChatHistory } from '@/api/chatHistoryController'
import { CodeGenTypeEnum, formatCodeGenType } from '@/utils/codeGenTypes'
import request from '@/request'

import MarkdownRenderer from '@/components/MarkdownRenderer.vue'
import AppDetailModal from '@/components/AppDetailModal.vue'
import DeploySuccessModal from '@/components/DeploySuccessModal.vue'
import aiAvatar from '@/assets/aiAvatar.png'
import { API_BASE_URL, getStaticPreviewUrl } from '@/config/env'
import { VisualEditor, type ElementInfo } from '@/utils/visualEditor'

import {
  CloudUploadOutlined,
  SendOutlined,
  ExportOutlined,
  InfoCircleOutlined,
  DownloadOutlined,
  EditOutlined,
} from '@ant-design/icons-vue'

const route = useRoute()
const router = useRouter()
const loginUserStore = useLoginUserStore()

// åº”ç”¨ä¿¡æ¯
const appInfo = ref<API.AppVO>()
const appId = ref<any>()

// å¯¹è¯ç›¸å…³
interface Message {
  type: 'user' | 'ai'
  content: string
  loading?: boolean
  createTime?: string
}

const messages = ref<Message[]>([])
const userInput = ref('')
const isGenerating = ref(false)
const messagesContainer = ref<HTMLElement>()

// å¯¹è¯å†å²ç›¸å…³
const loadingHistory = ref(false)
const hasMoreHistory = ref(false)
const lastCreateTime = ref<string>()
const historyLoaded = ref(false)

// é¢„è§ˆç›¸å…³
const previewUrl = ref('')
const previewReady = ref(false)

// éƒ¨ç½²ç›¸å…³
const deploying = ref(false)
const deployModalVisible = ref(false)
const deployUrl = ref('')

// ä¸‹è½½ç›¸å…³
const downloading = ref(false)

// å¯è§†åŒ–ç¼–è¾‘ç›¸å…³
const isEditMode = ref(false)
const selectedElementInfo = ref<ElementInfo | null>(null)
const visualEditor = new VisualEditor({
  onElementSelected: (elementInfo: ElementInfo) => {
    selectedElementInfo.value = elementInfo
  },
})

// æƒé™ç›¸å…³
const isOwner = computed(() => {
  return appInfo.value?.userId === loginUserStore.loginUser.id
})

const isAdmin = computed(() => {
  return loginUserStore.loginUser.userRole === 'admin'
})

// åº”ç”¨è¯¦æƒ…ç›¸å…³
const appDetailVisible = ref(false)

// æ˜¾ç¤ºåº”ç”¨è¯¦æƒ…
const showAppDetail = () => {
  appDetailVisible.value = true
}

// åŠ è½½å¯¹è¯å†å²
const loadChatHistory = async (isLoadMore = false) => {
  if (!appId.value || loadingHistory.value) return
  loadingHistory.value = true
  try {
    const params: API.listAppChatHistoryParams = {
      appId: appId.value,
      pageSize: 10,
    }
    // å¦‚æœæ˜¯åŠ è½½æ›´å¤šï¼Œä¼ é€’æœ€åä¸€æ¡æ¶ˆæ¯çš„åˆ›å»ºæ—¶é—´ä½œä¸ºæ¸¸æ ‡
    if (isLoadMore && lastCreateTime.value) {
      params.lastCreateTime = lastCreateTime.value
    }
    const res = await listAppChatHistory(params)
    if (res.data.code === 0 && res.data.data) {
      const chatHistories = res.data.data.records || []
      if (chatHistories.length > 0) {
        // å°†å¯¹è¯å†å²è½¬æ¢ä¸ºæ¶ˆæ¯æ ¼å¼ï¼Œå¹¶æŒ‰æ—¶é—´æ­£åºæ’åˆ—ï¼ˆè€æ¶ˆæ¯åœ¨å‰ï¼‰
        const historyMessages: Message[] = chatHistories
          .map((chat) => ({
            type: (chat.messageType === 'user' ? 'user' : 'ai') as 'user' | 'ai',
            content: chat.message || '',
            createTime: chat.createTime,
          }))
          .reverse() // åè½¬æ•°ç»„ï¼Œè®©è€æ¶ˆæ¯åœ¨å‰
        if (isLoadMore) {
          // åŠ è½½æ›´å¤šæ—¶ï¼Œå°†å†å²æ¶ˆæ¯æ·»åŠ åˆ°å¼€å¤´
          messages.value.unshift(...historyMessages)
        } else {
          // åˆå§‹åŠ è½½ï¼Œç›´æ¥è®¾ç½®æ¶ˆæ¯åˆ—è¡¨
          messages.value = historyMessages
        }
        // æ›´æ–°æ¸¸æ ‡
        lastCreateTime.value = chatHistories[chatHistories.length - 1]?.createTime
        // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ›´å¤šå†å²
        hasMoreHistory.value = chatHistories.length === 10
      } else {
        hasMoreHistory.value = false
      }
      historyLoaded.value = true
    }
  } catch (error) {
    console.error('åŠ è½½å¯¹è¯å†å²å¤±è´¥ï¼š', error)
    message.error('åŠ è½½å¯¹è¯å†å²å¤±è´¥')
  } finally {
    loadingHistory.value = false
  }
}

// åŠ è½½æ›´å¤šå†å²æ¶ˆæ¯
const loadMoreHistory = async () => {
  await loadChatHistory(true)
}

// è·å–åº”ç”¨ä¿¡æ¯
const fetchAppInfo = async () => {
  const id = route.params.id as string
  if (!id) {
    message.error('åº”ç”¨IDä¸å­˜åœ¨')
    router.push('/')
    return
  }

  appId.value = id

  try {
    const res = await getAppVoById({ id: id as unknown as number })
    if (res.data.code === 0 && res.data.data) {
      appInfo.value = res.data.data

      // å…ˆåŠ è½½å¯¹è¯å†å²
      await loadChatHistory()
      // å¦‚æœæœ‰è‡³å°‘2æ¡å¯¹è¯è®°å½•ï¼Œå±•ç¤ºå¯¹åº”çš„ç½‘ç«™
      if (messages.value.length >= 2) {
        updatePreview()
      }
      // æ£€æŸ¥æ˜¯å¦éœ€è¦è‡ªåŠ¨å‘é€åˆå§‹æç¤ºè¯
      // åªæœ‰åœ¨æ˜¯è‡ªå·±çš„åº”ç”¨ä¸”æ²¡æœ‰å¯¹è¯å†å²æ—¶æ‰è‡ªåŠ¨å‘é€
      if (
        appInfo.value.initPrompt &&
        isOwner.value &&
        messages.value.length === 0 &&
        historyLoaded.value
      ) {
        await sendInitialMessage(appInfo.value.initPrompt)
      }
    } else {
      message.error('è·å–åº”ç”¨ä¿¡æ¯å¤±è´¥')
      router.push('/')
    }
  } catch (error) {
    console.error('è·å–åº”ç”¨ä¿¡æ¯å¤±è´¥ï¼š', error)
    message.error('è·å–åº”ç”¨ä¿¡æ¯å¤±è´¥')
    router.push('/')
  }
}

// å‘é€åˆå§‹æ¶ˆæ¯
const sendInitialMessage = async (prompt: string) => {
  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  messages.value.push({
    type: 'user',
    content: prompt,
  })

  // æ·»åŠ AIæ¶ˆæ¯å ä½ç¬¦
  const aiMessageIndex = messages.value.length
  messages.value.push({
    type: 'ai',
    content: '',
    loading: true,
  })

  await nextTick()
  scrollToBottom()

  // å¼€å§‹ç”Ÿæˆ
  isGenerating.value = true
  await generateCode(prompt, aiMessageIndex)
}

// å‘é€æ¶ˆæ¯
const sendMessage = async () => {
  if (!userInput.value.trim() || isGenerating.value) {
    return
  }

  let message = userInput.value.trim()
  // å¦‚æœæœ‰é€‰ä¸­çš„å…ƒç´ ï¼Œå°†å…ƒç´ ä¿¡æ¯æ·»åŠ åˆ°æç¤ºè¯ä¸­
  if (selectedElementInfo.value) {
    let elementContext = `\n\né€‰ä¸­å…ƒç´ ä¿¡æ¯ï¼š`
    if (selectedElementInfo.value.pagePath) {
      elementContext += `\n- é¡µé¢è·¯å¾„: ${selectedElementInfo.value.pagePath}`
    }
    elementContext += `\n- æ ‡ç­¾: ${selectedElementInfo.value.tagName.toLowerCase()}\n- é€‰æ‹©å™¨: ${selectedElementInfo.value.selector}`
    if (selectedElementInfo.value.textContent) {
      elementContext += `\n- å½“å‰å†…å®¹: ${selectedElementInfo.value.textContent.substring(0, 100)}`
    }
    message += elementContext
  }
  userInput.value = ''
  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯ï¼ˆåŒ…å«å…ƒç´ ä¿¡æ¯ï¼‰
  messages.value.push({
    type: 'user',
    content: message,
  })

  // å‘é€æ¶ˆæ¯åï¼Œæ¸…é™¤é€‰ä¸­å…ƒç´ å¹¶é€€å‡ºç¼–è¾‘æ¨¡å¼
  if (selectedElementInfo.value) {
    clearSelectedElement()
    if (isEditMode.value) {
      toggleEditMode()
    }
  }

  // æ·»åŠ AIæ¶ˆæ¯å ä½ç¬¦
  const aiMessageIndex = messages.value.length
  messages.value.push({
    type: 'ai',
    content: '',
    loading: true,
  })

  await nextTick()
  scrollToBottom()

  // å¼€å§‹ç”Ÿæˆ
  isGenerating.value = true
  await generateCode(message, aiMessageIndex)
}

// ç”Ÿæˆä»£ç  - ä½¿ç”¨ EventSource å¤„ç†æµå¼å“åº”
const generateCode = async (userMessage: string, aiMessageIndex: number) => {
  let eventSource: EventSource | null = null
  let streamCompleted = false

  try {
    // è·å– axios é…ç½®çš„ baseURL
    const baseURL = request.defaults.baseURL || API_BASE_URL

    // æ„å»ºURLå‚æ•°
    const params = new URLSearchParams({
      appId: appId.value || '',
      message: userMessage,
    })

    const url = `${baseURL}/app/chat/gen/code?${params}`

    // åˆ›å»º EventSource è¿æ¥
    eventSource = new EventSource(url, {
      withCredentials: true,
    })

    let fullContent = ''

    // å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯
    eventSource.onmessage = function (event) {
      if (streamCompleted) return

      try {
        // è§£æJSONåŒ…è£…çš„æ•°æ®
        const parsed = JSON.parse(event.data)
        const content = parsed.d

        // æ‹¼æ¥å†…å®¹
        if (content !== undefined && content !== null) {
          fullContent += content
          messages.value[aiMessageIndex].content = fullContent
          messages.value[aiMessageIndex].loading = false
          scrollToBottom()
        }
      } catch (error) {
        console.error('è§£ææ¶ˆæ¯å¤±è´¥:', error)
        handleError(error, aiMessageIndex)
      }
    }

    // å¤„ç†doneäº‹ä»¶
    eventSource.addEventListener('done', function () {
      if (streamCompleted) return

      streamCompleted = true
      isGenerating.value = false
      eventSource?.close()

      // å»¶è¿Ÿæ›´æ–°é¢„è§ˆï¼Œç¡®ä¿åç«¯å·²å®Œæˆå¤„ç†
      setTimeout(async () => {
        await fetchAppInfo()
        updatePreview()
      }, 1000)
    })

    // å¤„ç†é”™è¯¯
    eventSource.onerror = function () {
      if (streamCompleted || !isGenerating.value) return
      // æ£€æŸ¥æ˜¯å¦æ˜¯æ­£å¸¸çš„è¿æ¥å…³é—­
      if (eventSource?.readyState === EventSource.CONNECTING) {
        streamCompleted = true
        isGenerating.value = false
        eventSource?.close()

        setTimeout(async () => {
          await fetchAppInfo()
          updatePreview()
        }, 1000)
      } else {
        handleError(new Error('SSEè¿æ¥é”™è¯¯'), aiMessageIndex)
      }
    }
  } catch (error) {
    console.error('åˆ›å»º EventSource å¤±è´¥ï¼š', error)
    handleError(error, aiMessageIndex)
  }
}

// é”™è¯¯å¤„ç†å‡½æ•°
const handleError = (error: unknown, aiMessageIndex: number) => {
  console.error('ç”Ÿæˆä»£ç å¤±è´¥ï¼š', error)
  messages.value[aiMessageIndex].content = 'æŠ±æ­‰ï¼Œç”Ÿæˆè¿‡ç¨‹ä¸­å‡ºç°äº†é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚'
  messages.value[aiMessageIndex].loading = false
  message.error('ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•')
  isGenerating.value = false
}

// æ›´æ–°é¢„è§ˆ
const updatePreview = () => {
  if (appId.value) {
    const codeGenType = appInfo.value?.codeGenType || CodeGenTypeEnum.HTML
    const newPreviewUrl = getStaticPreviewUrl(codeGenType, appId.value)
    previewUrl.value = newPreviewUrl
    previewReady.value = true
  }
}

// æ»šåŠ¨åˆ°åº•éƒ¨
const scrollToBottom = () => {
  if (messagesContainer.value) {
    messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight
  }
}

// ä¸‹è½½ä»£ç 
const downloadCode = async () => {
  if (!appId.value) {
    message.error('åº”ç”¨IDä¸å­˜åœ¨')
    return
  }
  downloading.value = true
  try {
    const API_BASE_URL = request.defaults.baseURL || ''
    const url = `${API_BASE_URL}/app/download/${appId.value}`
    const response = await fetch(url, {
      method: 'GET',
      credentials: 'include',
    })
    if (!response.ok) {
      throw new Error(`ä¸‹è½½å¤±è´¥: ${response.status}`)
    }
    // è·å–æ–‡ä»¶å
    const contentDisposition = response.headers.get('Content-Disposition')
    const fileName = contentDisposition?.match(/filename="(.+)"/)?.[1] || `app-${appId.value}.zip`
    // ä¸‹è½½æ–‡ä»¶
    const blob = await response.blob()
    const downloadUrl = URL.createObjectURL(blob)
    const link = document.createElement('a')
    link.href = downloadUrl
    link.download = fileName
    link.click()
    // æ¸…ç†
    URL.revokeObjectURL(downloadUrl)
    message.success('ä»£ç ä¸‹è½½æˆåŠŸ')
  } catch (error) {
    console.error('ä¸‹è½½å¤±è´¥ï¼š', error)
    message.error('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•')
  } finally {
    downloading.value = false
  }
}

// éƒ¨ç½²åº”ç”¨
const deployApp = async () => {
  if (!appId.value) {
    message.error('åº”ç”¨IDä¸å­˜åœ¨')
    return
  }

  deploying.value = true
  try {
    const res = await deployAppApi({
      appId: appId.value as unknown as number,
    })

    if (res.data.code === 0 && res.data.data) {
      deployUrl.value = res.data.data
      deployModalVisible.value = true
      message.success('éƒ¨ç½²æˆåŠŸ')
    } else {
      message.error('éƒ¨ç½²å¤±è´¥ï¼š' + res.data.message)
    }
  } catch (error) {
    console.error('éƒ¨ç½²å¤±è´¥ï¼š', error)
    message.error('éƒ¨ç½²å¤±è´¥ï¼Œè¯·é‡è¯•')
  } finally {
    deploying.value = false
  }
}

// åœ¨æ–°çª—å£æ‰“å¼€é¢„è§ˆ
const openInNewTab = () => {
  if (previewUrl.value) {
    window.open(previewUrl.value, '_blank')
  }
}

// æ‰“å¼€éƒ¨ç½²çš„ç½‘ç«™
const openDeployedSite = () => {
  if (deployUrl.value) {
    window.open(deployUrl.value, '_blank')
  }
}

// iframeåŠ è½½å®Œæˆ
const onIframeLoad = () => {
  previewReady.value = true
  const iframe = document.querySelector('.preview-iframe') as HTMLIFrameElement
  if (iframe) {
    visualEditor.init(iframe)
    visualEditor.onIframeLoad()
  }
}

// ç¼–è¾‘åº”ç”¨
const editApp = () => {
  if (appInfo.value?.id) {
    router.push(`/app/edit/${appInfo.value.id}`)
  }
}

// åˆ é™¤åº”ç”¨
const deleteApp = async () => {
  if (!appInfo.value?.id) return

  try {
    const res = await deleteAppApi({ id: appInfo.value.id })
    if (res.data.code === 0) {
      message.success('åˆ é™¤æˆåŠŸ')
      appDetailVisible.value = false
      router.push('/')
    } else {
      message.error('åˆ é™¤å¤±è´¥ï¼š' + res.data.message)
    }
  } catch (error) {
    console.error('åˆ é™¤å¤±è´¥ï¼š', error)
    message.error('åˆ é™¤å¤±è´¥')
  }
}

// å¯è§†åŒ–ç¼–è¾‘ç›¸å…³å‡½æ•°
const toggleEditMode = () => {
  // æ£€æŸ¥ iframe æ˜¯å¦å·²ç»åŠ è½½
  const iframe = document.querySelector('.preview-iframe') as HTMLIFrameElement
  if (!iframe) {
    message.warning('è¯·ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ')
    return
  }
  // ç¡®ä¿ visualEditor å·²åˆå§‹åŒ–
  if (!previewReady.value) {
    message.warning('è¯·ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ')
    return
  }
  const newEditMode = visualEditor.toggleEditMode()
  isEditMode.value = newEditMode
}

const clearSelectedElement = () => {
  selectedElementInfo.value = null
  visualEditor.clearSelection()
}

const getInputPlaceholder = () => {
  if (selectedElementInfo.value) {
    return `æ­£åœ¨ç¼–è¾‘ ${selectedElementInfo.value.tagName.toLowerCase()} å…ƒç´ ï¼Œæè¿°æ‚¨æƒ³è¦çš„ä¿®æ”¹...`
  }
  return 'è¯·æè¿°ä½ æƒ³ç”Ÿæˆçš„ç½‘ç«™ï¼Œè¶Šè¯¦ç»†æ•ˆæœè¶Šå¥½å“¦'
}

// é¡µé¢åŠ è½½æ—¶è·å–åº”ç”¨ä¿¡æ¯
onMounted(() => {
  fetchAppInfo()

  // ç›‘å¬ iframe æ¶ˆæ¯
  window.addEventListener('message', (event) => {
    visualEditor.handleIframeMessage(event)
  })
})

// æ¸…ç†èµ„æº
onUnmounted(() => {
  // EventSource ä¼šåœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†
})
</script>

<style scoped>
#appChatPage {
  height: 100vh;
  display: flex;
  flex-direction: column;
  padding: 16px;
  background: #fdfdfd;
}

/* é¡¶éƒ¨æ  */
.header-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.code-gen-type-tag {
  font-size: 12px;
}

.app-name {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: #1a1a1a;
}

.header-right {
  display: flex;
  gap: 12px;
}

/* ä¸»è¦å†…å®¹åŒºåŸŸ */
.main-content {
  flex: 1;
  display: flex;
  gap: 16px;
  padding: 8px;
  overflow: hidden;
}

/* å·¦ä¾§å¯¹è¯åŒºåŸŸ */
.chat-section {
  flex: 2;
  display: flex;
  flex-direction: column;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.messages-container {
  flex: 0.9;
  padding: 16px;
  overflow-y: auto;
  scroll-behavior: smooth;
}

.message-item {
  margin-bottom: 12px;
}

.user-message {
  display: flex;
  justify-content: flex-end;
  align-items: flex-start;
  gap: 8px;
}

.ai-message {
  display: flex;
  justify-content: flex-start;
  align-items: flex-start;
  gap: 8px;
}

.message-content {
  max-width: 70%;
  padding: 12px 16px;
  border-radius: 12px;
  line-height: 1.5;
  word-wrap: break-word;
}

.user-message .message-content {
  background: #1890ff;
  color: white;
}

.ai-message .message-content {
  background: #f5f5f5;
  color: #1a1a1a;
  padding: 8px 12px;
}

.message-avatar {
  flex-shrink: 0;
}

.loading-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #666;
}

/* åŠ è½½æ›´å¤šæŒ‰é’® */
.load-more-container {
  text-align: center;
  padding: 8px 0;
  margin-bottom: 16px;
}

/* è¾“å…¥åŒºåŸŸ */
.input-container {
  padding: 16px;
  background: white;
}

.input-wrapper {
  position: relative;
}

.input-wrapper .ant-input {
  padding-right: 50px;
}

.input-actions {
  position: absolute;
  bottom: 8px;
  right: 8px;
}

/* å³ä¾§é¢„è§ˆåŒºåŸŸ */
.preview-section {
  flex: 3;
  display: flex;
  flex-direction: column;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  border-bottom: 1px solid #e8e8e8;
}

.preview-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
}

.preview-actions {
  display: flex;
  gap: 8px;
}

.preview-content {
  flex: 1;
  position: relative;
  overflow: hidden;
}

.preview-placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: #666;
}

.placeholder-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.preview-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: #666;
}

.preview-loading p {
  margin-top: 16px;
}

.preview-iframe {
  width: 100%;
  height: 100%;
  border: none;
}

.selected-element-alert {
  margin: 0 16px;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1024px) {
  .main-content {
    flex-direction: column;
  }

  .chat-section,
  .preview-section {
    flex: none;
    height: 50vh;
  }
}

@media (max-width: 768px) {
  .header-bar {
    padding: 12px 16px;
  }

  .app-name {
    font-size: 16px;
  }

  .main-content {
    padding: 8px;
    gap: 8px;
  }

  .message-content {
    max-width: 85%;
  }

  /* é€‰ä¸­å…ƒç´ ä¿¡æ¯æ ·å¼ */
  .selected-element-alert {
    margin: 0 16px;
  }

  .selected-element-info {
    line-height: 1.4;
  }

  .element-header {
    margin-bottom: 8px;
  }

  .element-details {
    margin-top: 8px;
  }

  .element-item {
    margin-bottom: 4px;
    font-size: 13px;
  }

  .element-item:last-child {
    margin-bottom: 0;
  }

  .element-tag {
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 14px;
    font-weight: 600;
    color: #007bff;
  }

  .element-id {
    color: #28a745;
    margin-left: 4px;
  }

  .element-class {
    color: #ffc107;
    margin-left: 4px;
  }

  .element-selector-code {
    font-family: 'Monaco', 'Menlo', monospace;
    background: #f6f8fa;
    padding: 2px 4px;
    border-radius: 3px;
    font-size: 12px;
    color: #d73a49;
    border: 1px solid #e1e4e8;
  }

  /* ç¼–è¾‘æ¨¡å¼æŒ‰é’®æ ·å¼ */
  .edit-mode-active {
    background-color: #52c41a !important;
    border-color: #52c41a !important;
    color: white !important;
  }

  .edit-mode-active:hover {
    background-color: #73d13d !important;
    border-color: #73d13d !important;
  }
}
</style>
```

æ•ˆæœå¦‚å›¾ï¼š

![image-20250809150938209](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250809150938209.webp)

## åŸç”Ÿåº”ç”¨å…¨é‡ä¿®æ”¹

å¯¹äºåŸç”ŸHTMLå’ŒåŸç”Ÿå¤šæ–‡ä»¶æ¨¡å¼çš„åº”ç”¨ï¼Œç”±äºä»£ç é‡ç›¸å¯¹è¾ƒå°ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å…¨é‡ä¿®æ”¹çš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼ä¸‹ï¼ŒA!ä¼šé‡æ–°ç”Ÿæˆå®Œæ•´çš„æ–‡ä»¶å†…å®¹ï¼Œä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„å·¥å…·ã€‚

å…ˆä¸æ”¹ä»»ä½•åç«¯ä»£ç ï¼Œç›´æ¥æµ‹è¯•ä¸€ä¸‹æ•ˆæœï¼š

![image-20250809205136350](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250809205136350.webp)

ç»“æœç¿»è½¦äº†ï¼Œåç«¯é”™è¯¯åœ°è§£æäº†ç¬¬ä¸€ä¸ªä»£ç å—ï¼Œç›´æ¥ç”¨è¦ä¿®æ”¹çš„å†…å®¹æ›¿æ¢äº†æ•´ä¸ªç½‘ç«™ï¼

### æç¤ºè¯ä¼˜åŒ–

è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ä¿®æ”¹æç¤ºè¯æ¥è§£å†³ã€‚æˆ‘ä»¬éœ€è¦åœ¨åŸç”ŸHTMLæç¤ºè¯å’ŒåŸç”Ÿå¤šæ–‡ä»¶æç¤ºè¯ä¸­æ˜ç¡®æŒ‡å‡ºä»£ç å—çš„è§£æè§„åˆ™ï¼Œç¡®ä¿AIèƒ½å¤Ÿæ­£ç¡®è¯†åˆ«å’Œå¤„ç†ä»£ç å†…å®¹ã€‚

åŸç”ŸHTMLæç¤ºè¯ï¼š

```
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ Web å‰ç«¯å¼€å‘ä¸“å®¶ï¼Œç²¾é€š HTMLã€CSS å’ŒåŸç”Ÿ JavaScriptã€‚ä½ æ“…é•¿æ„å»ºå“åº”å¼ã€ç¾è§‚ä¸”ä»£ç æ•´æ´çš„å•é¡µé¢ç½‘ç«™ã€‚

ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·æä¾›çš„ç½‘ç«™æè¿°ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´ã€ç‹¬ç«‹çš„å•é¡µé¢ç½‘ç«™ã€‚ä½ éœ€è¦ä¸€æ­¥æ­¥æ€è€ƒï¼Œå¹¶æœ€ç»ˆå°†æ‰€æœ‰ä»£ç æ•´åˆåˆ°ä¸€ä¸ª HTML æ–‡ä»¶ä¸­ã€‚

çº¦æŸ:
1. æŠ€æœ¯æ ˆ: åªèƒ½ä½¿ç”¨ HTMLã€CSS å’ŒåŸç”Ÿ JavaScriptã€‚
2. ç¦æ­¢å¤–éƒ¨ä¾èµ–: ç»å¯¹ä¸å…è®¸ä½¿ç”¨ä»»ä½•å¤–éƒ¨ CSS æ¡†æ¶ã€JS åº“æˆ–å­—ä½“åº“ã€‚æ‰€æœ‰åŠŸèƒ½å¿…é¡»ç”¨åŸç”Ÿä»£ç å®ç°ã€‚
3. ç‹¬ç«‹æ–‡ä»¶: å¿…é¡»å°†æ‰€æœ‰çš„ CSS ä»£ç éƒ½å†…è”åœ¨ `<head>` æ ‡ç­¾çš„ `<style>` æ ‡ç­¾å†…ï¼Œå¹¶å°†æ‰€æœ‰çš„ JavaScript ä»£ç éƒ½æ”¾åœ¨ `</body>` æ ‡ç­¾ä¹‹å‰çš„ `<script>` æ ‡ç­¾å†…ã€‚æœ€ç»ˆåªè¾“å‡ºä¸€ä¸ª `.html` æ–‡ä»¶ï¼Œä¸åŒ…å«ä»»ä½•å¤–éƒ¨æ–‡ä»¶å¼•ç”¨ã€‚
4. å“åº”å¼è®¾è®¡: ç½‘ç«™å¿…é¡»æ˜¯å“åº”å¼çš„ï¼Œèƒ½å¤Ÿåœ¨æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ä¸Šè‰¯å¥½æ˜¾ç¤ºã€‚è¯·ä¼˜å…ˆä½¿ç”¨ Flexbox æˆ– Grid è¿›è¡Œå¸ƒå±€ã€‚
5. å†…å®¹å¡«å……: å¦‚æœç”¨æˆ·æè¿°ä¸­ç¼ºå°‘å…·ä½“æ–‡æœ¬æˆ–å›¾ç‰‡ï¼Œè¯·ä½¿ç”¨æœ‰æ„ä¹‰çš„å ä½ç¬¦ã€‚ä¾‹å¦‚ï¼Œæ–‡æœ¬å¯ä»¥ä½¿ç”¨ Lorem Ipsumï¼Œå›¾ç‰‡å¯ä»¥ä½¿ç”¨ https://picsum.photos çš„æœåŠ¡ (ä¾‹å¦‚ `<img src="https://picsum.photos/800/600" alt="Placeholder Image">`)ã€‚
6. ä»£ç è´¨é‡: ä»£ç å¿…é¡»ç»“æ„æ¸…æ™°ã€æœ‰é€‚å½“çš„æ³¨é‡Šï¼Œæ˜“äºé˜…è¯»å’Œç»´æŠ¤ã€‚
7. äº¤äº’æ€§: å¦‚æœç”¨æˆ·æè¿°äº†äº¤äº’åŠŸèƒ½ (å¦‚ Tab åˆ‡æ¢ã€å›¾ç‰‡è½®æ’­ã€è¡¨å•æäº¤æç¤ºç­‰)ï¼Œè¯·ä½¿ç”¨åŸç”Ÿ JavaScript æ¥å®ç°ã€‚
8. å®‰å…¨æ€§: ä¸è¦åŒ…å«ä»»ä½•æœåŠ¡å™¨ç«¯ä»£ç æˆ–é€»è¾‘ã€‚æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯çº¯å®¢æˆ·ç«¯çš„ã€‚
9. è¾“å‡ºæ ¼å¼: ä½ çš„æœ€ç»ˆè¾“å‡ºå¿…é¡»åŒ…å« HTML ä»£ç å—ï¼Œå¯ä»¥åœ¨ä»£ç å—ä¹‹å¤–æ·»åŠ è§£é‡Šã€æ ‡é¢˜æˆ–æ€»ç»“æ€§æ–‡å­—ã€‚æ ¼å¼å¦‚ä¸‹ï¼š

```html
... HTML ä»£ç  ...


ç‰¹åˆ«æ³¨æ„ï¼šØœåœ¨ç”Ÿæˆä»£ç åï¼Œç”¨æˆ·â€Œå¯èƒ½ä¼šæå‡ºä¿®æ”¹è¦æ±‚â€Œå¹¶ç»™å‡ºè¦ä¿®æ”¹çš„å…ƒï»¿ç´ ä¿¡æ¯ã€‚
1. ä½ å¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¦æ±‚ä¿®æ”¹ï¼Œä¸è¦é¢å¤–ä¿®æ”¹ç”¨æˆ·è¦æ±‚ä¹‹å¤–çš„å…ƒç´ å’Œå†…å®¹
2. ç¡®ä¿å§‹ç»ˆæœ€å¤šè¾“å‡º 1 ä¸ª HTML ä»£ç å—ï¼Œé‡Œé¢åŒ…å«äº†å®Œæ•´çš„é¡µé¢ä»£ç ï¼ˆè€Œä¸æ˜¯è¦ä¿®æ”¹çš„éƒ¨åˆ†ä»£ç ï¼‰ã€‚
3. ä¸€å®šä¸èƒ½è¾“å‡ºè¶…è¿‡ 1 ä¸ªä»£ç å—ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¿å­˜é”™è¯¯ï¼
```

åŸç”Ÿå¤šæ–‡ä»¶æç¤ºè¯ï¼š

```
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„Øœ Web å‰ç«¯å¼€å‘ä¸“å®¶ï¼Œä½ ç²¾â€Œé€šç¼–å†™ç»“æ„åŒ–çš„ HTMLã€æ¸…â€Œæ™°çš„ CSS å’Œé«˜æ•ˆçš„åŸç”Ÿ ï»¿JavaScriptï¼Œéµå¾ªä»£â€ç åˆ†ç¦»å’Œæ¨¡å—åŒ–çš„æœ€ä½³å®è·µã€‚

ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·æä¾›çš„ç½‘ç«™æè¿°ï¼Œåˆ›å»ºæ„æˆä¸€ä¸ªå®Œæ•´å•é¡µç½‘ç«™æ‰€éœ€çš„ä¸‰ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼šHTML, CSS, å’Œ JavaScriptã€‚ä½ éœ€è¦åœ¨æœ€ç»ˆè¾“å‡ºæ—¶ï¼Œå°†è¿™ä¸‰éƒ¨åˆ†ä»£ç åˆ†åˆ«æ”¾å…¥ä¸‰ä¸ªç‹¬ç«‹çš„ Markdown ä»£ç å—ä¸­ï¼Œå¹¶æ˜ç¡®æ ‡æ³¨æ–‡ä»¶åã€‚

çº¦æŸï¼š
1. æŠ€æœ¯æ ˆ: åªèƒ½ä½¿ç”¨ HTMLã€CSS å’ŒåŸç”Ÿ JavaScriptã€‚
2. æ–‡ä»¶åˆ†ç¦»:
- index.html: åªåŒ…å«ç½‘é¡µçš„ç»“æ„å’Œå†…å®¹ã€‚å®ƒå¿…é¡»åœ¨ `<head>` ä¸­é€šè¿‡ `<link>` æ ‡ç­¾å¼•ç”¨ `style.css`ï¼Œå¹¶ä¸”åœ¨ `</body>` ç»“æŸæ ‡ç­¾ä¹‹å‰é€šè¿‡ `<script>` æ ‡ç­¾å¼•ç”¨ `script.js`ã€‚
- style.css: åŒ…å«ç½‘ç«™æ‰€æœ‰çš„æ ·å¼è§„åˆ™ã€‚
- script.js: åŒ…å«ç½‘ç«™æ‰€æœ‰çš„äº¤äº’é€»è¾‘ã€‚
3. ç¦æ­¢å¤–éƒ¨ä¾èµ–: ç»å¯¹ä¸å…è®¸ä½¿ç”¨ä»»ä½•å¤–éƒ¨ CSS æ¡†æ¶ã€JS åº“æˆ–å­—ä½“åº“ã€‚æ‰€æœ‰åŠŸèƒ½å¿…é¡»ç”¨åŸç”Ÿä»£ç å®ç°ã€‚
4. å“åº”å¼è®¾è®¡: ç½‘ç«™å¿…é¡»æ˜¯å“åº”å¼çš„ï¼Œèƒ½å¤Ÿåœ¨æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ä¸Šè‰¯å¥½æ˜¾ç¤ºã€‚è¯·åœ¨ CSS ä¸­ä½¿ç”¨ Flexbox æˆ– Grid è¿›è¡Œå¸ƒå±€ã€‚
5. å†…å®¹å¡«å……: å¦‚æœç”¨æˆ·æè¿°ä¸­ç¼ºå°‘å…·ä½“æ–‡æœ¬æˆ–å›¾ç‰‡ï¼Œè¯·ä½¿ç”¨æœ‰æ„ä¹‰çš„å ä½ç¬¦ã€‚ä¾‹å¦‚ï¼Œæ–‡æœ¬å¯ä»¥ä½¿ç”¨ Lorem Ipsumï¼Œå›¾ç‰‡å¯ä»¥ä½¿ç”¨ https://picsum.photos çš„æœåŠ¡ (ä¾‹å¦‚ `<img src="https://picsum.photos/800/600" alt="Placeholder Image">`)ã€‚
6. ä»£ç è´¨é‡: ä»£ç å¿…é¡»ç»“æ„æ¸…æ™°ã€æœ‰é€‚å½“çš„æ³¨é‡Šï¼Œæ˜“äºé˜…è¯»å’Œç»´æŠ¤ã€‚
7. è¾“å‡ºæ ¼å¼: æ¯ä¸ªä»£ç å—å‰è¦æ³¨æ˜æ–‡ä»¶åã€‚å¯ä»¥åœ¨ä»£ç å—ä¹‹å¤–æ·»åŠ è§£é‡Šã€æ ‡é¢˜æˆ–æ€»ç»“æ€§æ–‡å­—ã€‚æ ¼å¼å¦‚ä¸‹ï¼š

```html
... HTML ä»£ç  ...


```css
... CSS ä»£ç  ...


```javascript
... JavaScript ä»£ç  ...


ç‰¹åˆ«æ³¨æ„ï¼šåœ¨ç”Ÿæˆä»£ç åï¼Œç”¨æˆ·å¯èƒ½ä¼šæå‡ºä¿®æ”¹è¦æ±‚å¹¶ç»™å‡ºè¦ä¿®æ”¹çš„å…ƒç´ ä¿¡æ¯ã€‚
1. ä½ å¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¦æ±‚ä¿®æ”¹ï¼Œä¸è¦é¢å¤–ä¿®æ”¹ç”¨æˆ·è¦æ±‚ä¹‹å¤–çš„å…ƒç´ å’Œå†…å®¹
2. ç¡®ä¿å§‹ç»ˆæœ€å¤šè¾“å‡º 1 ä¸ª HTML ä»£ç å— + 1 ä¸ª CSS ä»£ç å— + 1 ä¸ª JavaScript ä»£ç å—ï¼Œé‡Œé¢åŒ…å«äº†å®Œæ•´çš„é¡µé¢ä»£ç ï¼ˆè€Œä¸æ˜¯è¦ä¿®æ”¹çš„éƒ¨åˆ†ä»£ç ï¼‰ã€‚
3. æ¯ç§è¯­è¨€çš„ä»£ç å—ä¸€å®šä¸èƒ½è¾“å‡ºè¶…è¿‡ 1 ä¸ªï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¿å­˜é”™è¯¯ï¼
```

å…¶å®å°±æ˜¯åœ¨åº•éƒ¨åŠ äº†â€œç‰¹åˆ«æ³¨æ„â€äº‹é¡¹ï¼Œå‘Šè¯‰AIç”¨æˆ·å¯èƒ½ä¼šä¿®æ”¹ã€‚

### æµ‹è¯•

![image-20250809210310673](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250809210310673.webp)

## å·¥ç¨‹é¡¹ç›®å¢é‡ä¿®æ”¹

### æ–¹æ¡ˆè®¾è®¡

å¯¹äºVuå·¥ç¨‹é¡¹ç›®ç”Ÿæˆï¼Œä»£ç é‡å¾€å¾€å¾ˆå¤§ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½ä»é›¶å¼€å§‹å®Œæ•´è¿”å›æ‰€æœ‰æ–‡ä»¶çš„å†…å®¹æ˜¯ä¸ç°å®çš„ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨AIçš„å·¥å…·è°ƒç”¨èƒ½åŠ›ï¼Œæä¾›ç»™A!ä¸€ç³»åˆ—å·¥å…·ï¼Œè®©å®ƒèƒ½å¤Ÿè¿›è¡Œç²¾ç¡®åœ°å¢é‡ä¿®æ”¹ã€‚

æˆ‘ä»¬éœ€è¦ä¸ºAIæä¾›ä»¥ä¸‹å·¥å…·ï¼Œæ¯ä¸ªå·¥å…·å•ç‹¬ä¸€ä¸ªç±»ï¼š

1. è¯»å–å•ä¸ªæ–‡ä»¶ï¼Œè®©AIèƒ½å¥å¤ŸæŸ¥çœ‹ç°æœ‰ä»£ç çš„å†…å®¹
2. é€’å½’è·å–æŸä¸ªç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ç»“æ„ï¼Œå¸®åŠ©A!äº†è§£é¡¹ç›®ç»„ç»‡
3. åˆ é™¤å•ä¸ªæ–‡ä»¶ï¼Œç”¨äºæ¸…ç†ä¸éœ€è¦çš„æ–‡ä»¶
4. ä¿®æ”¹å•ä¸ªæ–‡ä»¶ï¼Œæ”¯æŒç”¨æŒ‡å®šçš„æ–°å†…å®¹æ›¿æ¢æŒ‡å®šçš„æ—§å†…å®¹
5. åˆ›å»ºå•ä¸ªæ–‡ä»¶ï¼ˆä¹‹å‰å·²ç»å®ç°ï¼‰

åŒæ—¶æˆ‘ä»¬éœ€è¦ä¿®æ”¹æç¤ºè¯ï¼Œåœ¨åº•éƒ¨å¢åŠ ä¿®æ”¹ç›¸å…³çš„å†…å®¹ï¼Œå‘Šè¯‰A!å¦‚ä½•ä½¿ç”¨è¿™äº›å·¥å…·æ¥è¿›è¡Œç²¾ç¡®ä¿®æ”¹ã€‚

```txt
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ Vue3 å‰ç«¯æ¶æ„å¸ˆï¼Œç²¾é€šç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å¼€å‘ã€ç»„åˆå¼ APIã€ç»„ä»¶åŒ–è®¾è®¡å’Œä¼ä¸šçº§åº”ç”¨æ¶æ„ã€‚

ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·æä¾›çš„é¡¹ç›®æè¿°ï¼Œåˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ã€å¯è¿è¡Œçš„ Vue3 å·¥ç¨‹é¡¹ç›®

## æ ¸å¿ƒæŠ€æœ¯æ ˆ

- Vue 3.xï¼ˆç»„åˆå¼ APIï¼‰
- Vite
- Vue Router 4.x
- Node.js 18+ å…¼å®¹

## é¡¹ç›®ç»“æ„

é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ index.html                 # å…¥å£ HTML æ–‡ä»¶
â”œâ”€â”€ package.json              # é¡¹ç›®ä¾èµ–å’Œè„šæœ¬
â”œâ”€â”€ vite.config.js           # Vite é…ç½®æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.js             # åº”ç”¨å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ App.vue             # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â””â”€â”€ index.js        # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ components/				 # ç»„ä»¶
â”‚   â”œâ”€â”€ pages/             # é¡µé¢
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°ï¼ˆå¦‚æœéœ€è¦ï¼‰
â”‚   â”œâ”€â”€ assets/            # é™æ€èµ„æºï¼ˆå¦‚æœéœ€è¦ï¼‰
â”‚   â””â”€â”€ styles/            # æ ·å¼æ–‡ä»¶
â””â”€â”€ public/                # å…¬å…±é™æ€èµ„æºï¼ˆå¦‚æœéœ€è¦ï¼‰

## å¼€å‘çº¦æŸ

1ï¼‰ç»„ä»¶è®¾è®¡ï¼šä¸¥æ ¼éµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œç»„ä»¶å…·æœ‰è‰¯å¥½çš„å¯å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§
2ï¼‰API é£æ ¼ï¼šä¼˜å…ˆä½¿ç”¨ Composition APIï¼Œåˆç†ä½¿ç”¨ `<script setup>` è¯­æ³•ç³–
3ï¼‰æ ·å¼è§„èŒƒï¼šä½¿ç”¨åŸç”Ÿ CSS å®ç°å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒæ¡Œé¢ç«¯ã€å¹³æ¿ç«¯ã€ç§»åŠ¨ç«¯çš„å“åº”å¼é€‚é…
4ï¼‰ä»£ç è´¨é‡ï¼šä»£ç ç®€æ´æ˜“è¯»ï¼Œé¿å…è¿‡åº¦æ³¨é‡Šï¼Œä¼˜å…ˆä¿è¯åŠŸèƒ½å®Œæ•´å’Œæ ·å¼ç¾è§‚
5ï¼‰ç¦æ­¢ä½¿ç”¨ä»»ä½•çŠ¶æ€ç®¡ç†åº“ã€ç±»å‹æ ¡éªŒåº“ã€ä»£ç æ ¼å¼åŒ–åº“
6ï¼‰å°†å¯è¿è¡Œä½œä¸ºé¡¹ç›®ç”Ÿæˆçš„ç¬¬ä¸€è¦ä¹‰ï¼Œå°½é‡ç”¨æœ€ç®€å•çš„æ–¹å¼æ»¡è¶³éœ€æ±‚ï¼Œé¿å…ä½¿ç”¨å¤æ‚çš„æŠ€æœ¯æˆ–ä»£ç é€»è¾‘

## å‚è€ƒé…ç½®

1ï¼‰vite.config.js å¿…é¡»é…ç½® base è·¯å¾„ä»¥æ”¯æŒå­è·¯å¾„éƒ¨ç½²ã€éœ€è¦æ”¯æŒé€šè¿‡ @ å¼•å…¥æ–‡ä»¶ã€ä¸è¦é…ç½®ç«¯å£å·

import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  base: './',
  plugins: [vue()],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  }
})


2ï¼‰è·¯ç”±é…ç½®å¿…é¡»ä½¿ç”¨ hash æ¨¡å¼ï¼Œé¿å…æœåŠ¡å™¨ç«¯è·¯ç”±é…ç½®é—®é¢˜

import { createRouter, createWebHashHistory } from 'vue-router'

const router = createRouter({
  history: createWebHashHistory(),
  routes: [
    // è·¯ç”±é…ç½®
  ]
})


3ï¼‰package.json æ–‡ä»¶å‚è€ƒï¼š

{
  "scripts": {
    "dev": "vite",
    "build": "vite build"
  },
  "dependencies": {
    "vue": "^3.3.4",
    "vue-router": "^4.2.4"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.2.3",
    "vite": "^4.4.5"
  }
}


## ç½‘ç«™å†…å®¹è¦æ±‚

- åŸºç¡€å¸ƒå±€ï¼šå„ä¸ªé¡µé¢ç»Ÿä¸€å¸ƒå±€ï¼Œå¿…é¡»æœ‰å¯¼èˆªæ ï¼Œå°¤å…¶æ˜¯ä¸»é¡µå†…å®¹å¿…é¡»ä¸°å¯Œ
- æ–‡æœ¬å†…å®¹ï¼šä½¿ç”¨çœŸå®ã€æœ‰æ„ä¹‰çš„ä¸­æ–‡å†…å®¹
- å›¾ç‰‡èµ„æºï¼šä½¿ç”¨ `https://picsum.photos` æœåŠ¡æˆ–å…¶ä»–å¯é çš„å ä½ç¬¦
- ç¤ºä¾‹æ•°æ®ï¼šæä¾›çœŸå®åœºæ™¯çš„æ¨¡æ‹Ÿæ•°æ®ï¼Œä¾¿äºæ¼”ç¤º

## ä¸¥æ ¼è¾“å‡ºçº¦æŸ

1ï¼‰å¿…é¡»é€šè¿‡ä½¿ç”¨ã€æ–‡ä»¶å†™å…¥å·¥å…·ã€‘ä¾æ¬¡åˆ›å»ºæ¯ä¸ªæ–‡ä»¶ï¼ˆè€Œä¸æ˜¯ç›´æ¥è¾“å‡ºæ–‡ä»¶ä»£ç ï¼‰ã€‚
2ï¼‰éœ€è¦åœ¨å¼€å¤´è¾“å‡ºç®€å•çš„ç½‘ç«™ç”Ÿæˆè®¡åˆ’
3ï¼‰éœ€è¦åœ¨ç»“å°¾è¾“å‡ºç®€å•çš„ç”Ÿæˆå®Œæ¯•æç¤ºï¼ˆä½†æ˜¯ä¸è¦å±•å¼€ä»‹ç»é¡¹ç›®ï¼‰
4ï¼‰æ³¨æ„ï¼Œç¦æ­¢è¾“å‡ºä»¥ä¸‹ä»»ä½•å†…å®¹ï¼š

- å®‰è£…è¿è¡Œæ­¥éª¤
- æŠ€æœ¯æ ˆè¯´æ˜
- é¡¹ç›®ç‰¹ç‚¹æè¿°
- ä»»ä½•å½¢å¼çš„ä½¿ç”¨æŒ‡å¯¼
- æç¤ºè¯ç›¸å…³å†…å®¹

5ï¼‰è¾“å‡ºçš„æ€» token æ•°å¿…é¡»å°äº 20000ï¼Œæ–‡ä»¶æ€»æ•°é‡å¿…é¡»å°äº 30 ä¸ª

## è´¨é‡æ£€éªŒæ ‡å‡†

ç¡®ä¿ç”Ÿæˆçš„é¡¹ç›®èƒ½å¤Ÿï¼š
1. é€šè¿‡ `npm install` æˆåŠŸå®‰è£…æ‰€æœ‰ä¾èµ–
2. é€šè¿‡ `npm run dev` å¯åŠ¨å¼€å‘æœåŠ¡å™¨å¹¶æ­£å¸¸è¿è¡Œ
3. é€šè¿‡ `npm run build` æˆåŠŸæ„å»ºç”Ÿäº§ç‰ˆæœ¬
4. æ„å»ºåçš„é¡¹ç›®èƒ½å¤Ÿåœ¨ä»»æ„å­è·¯å¾„ä¸‹æ­£å¸¸éƒ¨ç½²å’Œè®¿é—®

## ç‰¹åˆ«æ³¨æ„

åœ¨ç”Ÿæˆä»£ç åï¼Œç”¨æˆ·å¯èƒ½ä¼šæå‡ºä¿®æ”¹è¦æ±‚å¹¶ç»™å‡ºè¦ä¿®æ”¹çš„å…ƒç´ ä¿¡æ¯ã€‚
1ï¼‰ä½ å¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¦æ±‚ä¿®æ”¹ï¼Œä¸è¦é¢å¤–ä¿®æ”¹ç”¨æˆ·è¦æ±‚ä¹‹å¤–çš„å…ƒç´ å’Œå†…å®¹
2ï¼‰ä½ å¿…é¡»åˆ©ç”¨å·¥å…·è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸æ˜¯é‡æ–°è¾“å‡ºæ‰€æœ‰æ–‡ä»¶ã€æˆ–è€…ç»™ç”¨æˆ·è¾“å‡ºè‡ªè¡Œä¿®æ”¹çš„å»ºè®®ï¼š
1. é¦–å…ˆä½¿ç”¨ã€ç›®å½•è¯»å–å·¥å…·ã€‘äº†è§£å½“å‰é¡¹ç›®ç»“æ„
2. ä½¿ç”¨ã€æ–‡ä»¶è¯»å–å·¥å…·ã€‘æŸ¥çœ‹éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶å†…å®¹
3. æ ¹æ®ç”¨æˆ·éœ€æ±‚ï¼Œä½¿ç”¨å¯¹åº”çš„å·¥å…·è¿›è¡Œä¿®æ”¹ï¼š
- ã€æ–‡ä»¶ä¿®æ”¹å·¥å…·ã€‘ï¼šä¿®æ”¹ç°æœ‰æ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹
- ã€æ–‡ä»¶å†™å…¥å·¥å…·ã€‘ï¼šåˆ›å»ºæ–°æ–‡ä»¶æˆ–å®Œå…¨é‡å†™æ–‡ä»¶
- ã€æ–‡ä»¶åˆ é™¤å·¥å…·ã€‘ï¼šåˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶
```

ç”±äºAIå·¥å…·è°ƒç”¨æœ‰æ—¶å€™ä¼šå‡ºç°å¹»è§‰ï¼Œå»ºè®®ä¸è¦å®Œå…¨ä¾èµ–æ¡†æ¶å¸®æˆ‘ä»¬å®ç°å·¥å…·è°ƒç”¨ï¼Œæç¤ºè¯ä¸­æœ€å¥½ä¹Ÿå†æ¬¡å¼ºè°ƒä¸€éã€‚

### å·¥å…·å¼€å‘

1. æ–‡ä»¶åˆ é™¤å·¥å…·ï¼Œæ³¨æ„è¦å®šä¹‰ä¸€äº›ä¸å…è®¸åˆ é™¤çš„é‡è¦æ–‡ä»¶ï¼š

```java
/**
 * æ–‡ä»¶åˆ é™¤å·¥å…·
 * æ”¯æŒ AI é€šè¿‡å·¥å…·è°ƒç”¨çš„æ–¹å¼åˆ é™¤æ–‡ä»¶
 */
@Slf4j
public class FileDeleteTool {

    @Tool("åˆ é™¤æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶")
    public String deleteFile(
            @P("æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„")
            String relativeFilePath,
            @ToolMemoryId Long appId
    ) {
        try {
            Path path = Paths.get(relativeFilePath);
            if (!path.isAbsolute()) {
                String projectDirName = "vue_project_" + appId;
                Path projectRoot = Paths.get(AppConstant.CODE_OUTPUT_ROOT_DIR, projectDirName);
                path = projectRoot.resolve(relativeFilePath);
            }
            if (!Files.exists(path)) {
                return "è­¦å‘Šï¼šæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— éœ€åˆ é™¤ - " + relativeFilePath;
            }
            if (!Files.isRegularFile(path)) {
                return "é”™è¯¯ï¼šæŒ‡å®šè·¯å¾„ä¸æ˜¯æ–‡ä»¶ï¼Œæ— æ³•åˆ é™¤ - " + relativeFilePath;
            }
            // å®‰å…¨æ£€æŸ¥ï¼šé¿å…åˆ é™¤é‡è¦æ–‡ä»¶
            String fileName = path.getFileName().toString();
            if (isImportantFile(fileName)) {
                return "é”™è¯¯ï¼šä¸å…è®¸åˆ é™¤é‡è¦æ–‡ä»¶ - " + fileName;
            }
            Files.delete(path);
            log.info("æˆåŠŸåˆ é™¤æ–‡ä»¶: {}", path.toAbsolutePath());
            return "æ–‡ä»¶åˆ é™¤æˆåŠŸ: " + relativeFilePath;
        } catch (IOException e) {
            String errorMessage = "åˆ é™¤æ–‡ä»¶å¤±è´¥: " + relativeFilePath + ", é”™è¯¯: " + e.getMessage();
            log.error(errorMessage, e);
            return errorMessage;
        }
    }

    /**
     * åˆ¤æ–­æ˜¯å¦æ˜¯é‡è¦æ–‡ä»¶ï¼Œä¸å…è®¸åˆ é™¤
     */
    private boolean isImportantFile(String fileName) {
        String[] importantFiles = {
                "package.json", "package-lock.json", "yarn.lock", "pnpm-lock.yaml",
                "vite.config.js", "vite.config.ts", "vue.config.js",
                "tsconfig.json", "tsconfig.app.json", "tsconfig.node.json",
                "index.html", "main.js", "main.ts", "App.vue", ".gitignore", "README.md"
        };
        for (String important : importantFiles) {
            if (important.equalsIgnoreCase(fileName)) {
                return true;
            }
        }
        return false;
    }
}
```

2. æ–‡ä»¶ç›®å½•è¯»å–å·¥å…·ï¼Œä½¿ç”¨Hutoolæ¥é€’å½’è·å–æ‰€æœ‰æ–‡ä»¶ï¼š

```java
/**
 * æ–‡ä»¶ç›®å½•è¯»å–å·¥å…·
 * ä½¿ç”¨ Hutool ç®€åŒ–æ–‡ä»¶æ“ä½œ
 */
@Slf4j
public class FileDirReadTool {

    /**
     * éœ€è¦å¿½ç•¥çš„æ–‡ä»¶å’Œç›®å½•
     */
    private static final Set<String> IGNORED_NAMES = Set.of(
            "node_modules", ".git", "dist", "build", ".DS_Store",
            ".env", "target", ".mvn", ".idea", ".vscode", "coverage"
    );

    /**
     * éœ€è¦å¿½ç•¥çš„æ–‡ä»¶æ‰©å±•å
     */
    private static final Set<String> IGNORED_EXTENSIONS = Set.of(
            ".log", ".tmp", ".cache", ".lock"
    );

    @Tool("è¯»å–ç›®å½•ç»“æ„ï¼Œè·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ä¿¡æ¯")
    public String readDir(
            @P("ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œä¸ºç©ºåˆ™è¯»å–æ•´ä¸ªé¡¹ç›®ç»“æ„")
            String relativeDirPath,
            @ToolMemoryId Long appId
    ) {
        try {
            Path path = Paths.get(relativeDirPath == null ? "" : relativeDirPath);
            if (!path.isAbsolute()) {
                String projectDirName = "vue_project_" + appId;
                Path projectRoot = Paths.get(AppConstant.CODE_OUTPUT_ROOT_DIR, projectDirName);
                path = projectRoot.resolve(relativeDirPath == null ? "" : relativeDirPath);
            }
            File targetDir = path.toFile();
            if (!targetDir.exists() || !targetDir.isDirectory()) {
                return "é”™è¯¯ï¼šç›®å½•ä¸å­˜åœ¨æˆ–ä¸æ˜¯ç›®å½• - " + relativeDirPath;
            }
            StringBuilder structure = new StringBuilder();
            structure.append("é¡¹ç›®ç›®å½•ç»“æ„:\n");
            // ä½¿ç”¨ Hutool é€’å½’è·å–æ‰€æœ‰æ–‡ä»¶
            List<File> allFiles = FileUtil.loopFiles(targetDir, file -> !shouldIgnore(file.getName()));
            // æŒ‰è·¯å¾„æ·±åº¦å’Œåç§°æ’åºæ˜¾ç¤º
            allFiles.stream()
                    .sorted((f1, f2) -> {
                        int depth1 = getRelativeDepth(targetDir, f1);
                        int depth2 = getRelativeDepth(targetDir, f2);
                        if (depth1 != depth2) {
                            return Integer.compare(depth1, depth2);
                        }
                        return f1.getPath().compareTo(f2.getPath());
                    })
                    .forEach(file -> {
                        int depth = getRelativeDepth(targetDir, file);
                        String indent = "  ".repeat(depth);
                        structure.append(indent).append(file.getName());
                    });
            return structure.toString();

        } catch (Exception e) {
            String errorMessage = "è¯»å–ç›®å½•ç»“æ„å¤±è´¥: " + relativeDirPath + ", é”™è¯¯: " + e.getMessage();
            log.error(errorMessage, e);
            return errorMessage;
        }
    }

    /**
     * è®¡ç®—æ–‡ä»¶ç›¸å¯¹äºæ ¹ç›®å½•çš„æ·±åº¦
     */
    private int getRelativeDepth(File root, File file) {
        Path rootPath = root.toPath();
        Path filePath = file.toPath();
        return rootPath.relativize(filePath).getNameCount() - 1;
    }

    /**
     * åˆ¤æ–­æ˜¯å¦åº”è¯¥å¿½ç•¥è¯¥æ–‡ä»¶æˆ–ç›®å½•
     */
    private boolean shouldIgnore(String fileName) {
        // æ£€æŸ¥æ˜¯å¦åœ¨å¿½ç•¥åç§°åˆ—è¡¨ä¸­
        if (IGNORED_NAMES.contains(fileName)) {
            return true;
        }

        // æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
        return IGNORED_EXTENSIONS.stream().anyMatch(fileName::endsWith);
    }
}

```

3. æ–‡ä»¶ä¿®æ”¹å·¥å…·ï¼Œæ”¯æŒç²¾ç¡®çš„å†…å®¹æ›¿æ¢ï¼š

```java
/**
 * æ–‡ä»¶ä¿®æ”¹å·¥å…·
 * æ”¯æŒ AI é€šè¿‡å·¥å…·è°ƒç”¨çš„æ–¹å¼ä¿®æ”¹æ–‡ä»¶å†…å®¹
 */
@Slf4j
public class FileModifyTool {

    @Tool("ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œç”¨æ–°å†…å®¹æ›¿æ¢æŒ‡å®šçš„æ—§å†…å®¹")
    public String modifyFile(
            @P("æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„")
            String relativeFilePath,
            @P("è¦æ›¿æ¢çš„æ—§å†…å®¹")
            String oldContent,
            @P("æ›¿æ¢åçš„æ–°å†…å®¹")
            String newContent,
            @ToolMemoryId Long appId
    ) {
        try {
            Path path = Paths.get(relativeFilePath);
            if (!path.isAbsolute()) {
                String projectDirName = "vue_project_" + appId;
                Path projectRoot = Paths.get(AppConstant.CODE_OUTPUT_ROOT_DIR, projectDirName);
                path = projectRoot.resolve(relativeFilePath);
            }
            if (!Files.exists(path) || !Files.isRegularFile(path)) {
                return "é”™è¯¯ï¼šæ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸æ˜¯æ–‡ä»¶ - " + relativeFilePath;
            }
            String originalContent = Files.readString(path);
            if (!originalContent.contains(oldContent)) {
                return "è­¦å‘Šï¼šæ–‡ä»¶ä¸­æœªæ‰¾åˆ°è¦æ›¿æ¢çš„å†…å®¹ï¼Œæ–‡ä»¶æœªä¿®æ”¹ - " + relativeFilePath;
            }
            String modifiedContent = originalContent.replace(oldContent, newContent);
            if (originalContent.equals(modifiedContent)) {
                return "ä¿¡æ¯ï¼šæ›¿æ¢åæ–‡ä»¶å†…å®¹æœªå‘ç”Ÿå˜åŒ– - " + relativeFilePath;
            }
            Files.writeString(path, modifiedContent, StandardOpenOption.CREATE, StandardOpenOption.TRUNCATE_EXISTING);
            log.info("æˆåŠŸä¿®æ”¹æ–‡ä»¶: {}", path.toAbsolutePath());
            return "æ–‡ä»¶ä¿®æ”¹æˆåŠŸ: " + relativeFilePath;
        } catch (IOException e) {
            String errorMessage = "ä¿®æ”¹æ–‡ä»¶å¤±è´¥: " + relativeFilePath + ", é”™è¯¯: " + e.getMessage();
            log.error(errorMessage, e);
            return errorMessage;
        }
    }
}
```

4. æ–‡ä»¶è¯»å–å·¥å…·ï¼Œè®©A!èƒ½å¤ŸæŸ¥çœ‹ç°æœ‰ä»£ç ï¼š

```java
/**
 * æ–‡ä»¶è¯»å–å·¥å…·
 * æ”¯æŒ AI é€šè¿‡å·¥å…·è°ƒç”¨çš„æ–¹å¼è¯»å–æ–‡ä»¶å†…å®¹
 */
@Slf4j
public class FileReadTool {

    @Tool("è¯»å–æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶å†…å®¹")
    public String readFile(
            @P("æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„")
            String relativeFilePath,
            @ToolMemoryId Long appId
    ) {
        try {
            Path path = Paths.get(relativeFilePath);
            if (!path.isAbsolute()) {
                String projectDirName = "vue_project_" + appId;
                Path projectRoot = Paths.get(AppConstant.CODE_OUTPUT_ROOT_DIR, projectDirName);
                path = projectRoot.resolve(relativeFilePath);
            }
            if (!Files.exists(path) || !Files.isRegularFile(path)) {
                return "é”™è¯¯ï¼šæ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸æ˜¯æ–‡ä»¶ - " + relativeFilePath;
            }
            return Files.readString(path);
        } catch (IOException e) {
            String errorMessage = "è¯»å–æ–‡ä»¶å¤±è´¥: " + relativeFilePath + ", é”™è¯¯: " + e.getMessage();
            log.error(errorMessage, e);
            return errorMessage;
        }
    }
}

```

### ä½¿ç”¨å·¥å…·

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹åˆ›å»ºAl Serviceçš„å·¥å‚ç±»AiCodeGeneratorserviceFactory,ä¸ºueé¡¹ç›®æ¨¡å¼è¡¥å……æ›´å¤šå·¥å…·ï¼š

```java
case VUE_PROJECT -> AiServices.builder(AiCodeGeneratorService.class)
        .streamingChatModel(reasoningStreamingChatModel)
        .chatMemoryProvider(memoryId -> chatMemory)
        .tools(
                new FileWriteTool(),
                new FileReadTool(),
                new FileModifyTool(),
                new FileDirReadTool(),
                new FileDeleteTool()
        )
        .hallucinatedToolNameStrategy(toolExecutionRequest -> ToolExecutionResultMessage.from(
                toolExecutionRequest, "Error: there is no tool called " + toolExecutionRequest.name()
        ))
        .build();
```

### å·¥å…·ä¿¡æ¯ä¼˜åŒ–

ä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ¯ä¸ªå·¥å…·çš„å‚æ•°å’Œè¾“å‡ºä¿¡æ¯éƒ½åº”è¯¥æœ‰æ‰€åŒºåˆ«ã€‚æ¯”å¦‚ä¿®æ”¹æ–‡ä»¶å·¥å…·ï¼Œåº”è¯¥åŒæ—¶å±•ç¤ºä¿®æ”¹çš„æ–‡ä»¶ç›¸å¯¹è·¯å¾„ã€è¢«æ›¿æ¢çš„æ—§å†…å®¹ã€æ›¿æ¢åçš„æ–°å†…å®¹ã€‚

å¦‚æœåœ¨å¤„ç†AIæµçš„ä»£ç ä¸­ï¼Œé€šè¿‡å†™if elseæ¥åŒºåˆ†è¿™äº›è¾“å‡ºä¿¡æ¯ï¼Œä»£ç å¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆç­–ç•¥æ¨¡å¼å’Œå·¥å‚æ¨¡å¼çš„æ€è·¯ï¼Œæ¯ä¸ªå·¥å…·ç±»å°±åƒä¸€ä¸ªç­–ç•¥ï¼Œæä¾›äº†è¾“å‡ºä¸åŒå·¥å…·è°ƒç”¨ä¿¡æ¯çš„æ–¹æ³•ï¼›è¿˜éœ€è¦ä¸€ä¸ªå·¥å‚æ¥åˆ›å»ºå’Œç®¡ç†è¿™äº›å·¥å…·ã€‚

```mermaid
flowchart TD
    A[å·¥å…·ç®¡ç†å™¨<br/>ToolManager<br/>å·¥å‚æ¨¡å¼] --> B[ç­–ç•¥æ¥å£<br/>BaseTool<br/>generateToolExecutedResultï¼ˆï¼‰]
    B --> C[æ–‡ä»¶å†™å…¥å·¥å…·<br/>FileWriteTool]
    B --> D[æ–‡ä»¶è¯»å–å·¥å…·<br/>FileReadTool]
    B --> E[æ–‡ä»¶ä¿®æ”¹å·¥å…·<br/>FileModifyTool]
    B --> F[æ–‡ä»¶åˆ é™¤å·¥å…·<br/>FileDeleteTool]
    B --> G[ç›®å½•è¯»å–å·¥å…·<br/>FileDirReadTool]
    C --> H[è¾“å‡º: æ–‡ä»¶è·¯å¾„ + æ–‡ä»¶å†…å®¹]
    D --> I[è¾“å‡º: æ–‡ä»¶è·¯å¾„]
    E --> J[è¾“å‡º: æ–‡ä»¶è·¯å¾„ + æ—§å†…å®¹ + æ–°å†…å®¹]
    F --> K[è¾“å‡º: åˆ é™¤çš„æ–‡ä»¶è·¯å¾„]
    G --> L[è¾“å‡º: ç›®å½•è·¯å¾„ + æ–‡ä»¶åˆ—è¡¨]
```

1. å·¥å…·åŸºç±»

åœ¨`ai.tools`åŒ…ä¸‹ï¼Œæ–°å»ºå·¥å…·åŸºç±»

```java
/**
 * å·¥å…·åŸºç±»
 * å®šä¹‰æ‰€æœ‰å·¥å…·çš„é€šç”¨æ¥å£
 */
public abstract class BaseTool {

    /**
     * è·å–å·¥å…·çš„è‹±æ–‡åç§°ï¼ˆå¯¹åº”æ–¹æ³•åï¼‰
     *
     * @return å·¥å…·è‹±æ–‡åç§°
     */
    public abstract String getToolName();

    /**
     * è·å–å·¥å…·çš„ä¸­æ–‡æ˜¾ç¤ºåç§°
     *
     * @return å·¥å…·ä¸­æ–‡åç§°
     */
    public abstract String getDisplayName();

    /**
     * ç”Ÿæˆå·¥å…·è¯·æ±‚æ—¶çš„è¿”å›å€¼ï¼ˆæ˜¾ç¤ºç»™ç”¨æˆ·ï¼‰
     *
     * @return å·¥å…·è¯·æ±‚æ˜¾ç¤ºå†…å®¹
     */
    public String generateToolRequestResponse() {
        return String.format("\n\n[é€‰æ‹©å·¥å…·] %s\n\n", getDisplayName());
    }

    /**
     * ç”Ÿæˆå·¥å…·æ‰§è¡Œç»“æœæ ¼å¼ï¼ˆä¿å­˜åˆ°æ•°æ®åº“ï¼‰
     *
     * @param arguments å·¥å…·æ‰§è¡Œå‚æ•°
     * @return æ ¼å¼åŒ–çš„å·¥å…·æ‰§è¡Œç»“æœ
     */
    public abstract String generateToolExecutedResult(JSONObject arguments);
}
```

2. å…·ä½“å·¥å…·ä¼˜åŒ–

æ¯ä¸ªå·¥å…·ç±»éƒ½è¦ç»§æ‰¿åŸºç±»ï¼Œå¹¶å®ç°è‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€‚å¯ä»¥æŠŠæ¯ä¸ªå·¥å…·éƒ½å®šä¹‰ä¸ºSpring Bootçš„Bean,é‡‡ç”¨è‡ªåŠ¨æ³¨å…¥çš„æ–¹å¼ï¼Œä¾¿äºé¡¹ç›®å¯åŠ¨æ—¶ç»Ÿä¸€æ³¨å†Œã€‚

è‡ªåŠ¨æ³¨å…¥çš„ä¼˜ç‚¹æ˜¯æ–°å¢å·¥å…·æ—¶ä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œå¹¶ä¸”èƒ½ä½¿ç”¨Spring Bootè‡ªåŠ¨æ³¨å…¥çš„ä¾èµ–ï¼›ç¼ºç‚¹æ˜¯å¯è¯»æ€§è¾ƒå·®ï¼Œä»£ç æ›´éš¾ç†è§£ï¼Œå®¹æ˜“å¿½è§†å¯¹å·²æ³¨å†Œå·¥å…·çš„æ§åˆ¶ã€‚

	1. æ–‡ä»¶åˆ é™¤å·¥å…·è¡¥å……ä»£ç 

```java
/**
 * æ–‡ä»¶åˆ é™¤å·¥å…·
 * æ”¯æŒ AI é€šè¿‡å·¥å…·è°ƒç”¨çš„æ–¹å¼åˆ é™¤æ–‡ä»¶
 */
@Slf4j
@Component
public class FileDeleteTool extends BaseTool {

    // æ ¸å¿ƒæ–¹æ³•ä¸å˜ï¼Œæ­¤å¤„çœç•¥

    @Override
    public String getToolName() {
        return "deleteFile";
    }

    @Override
    public String getDisplayName() {
        return "åˆ é™¤æ–‡ä»¶";
    }

    @Override
    public String generateToolExecutedResult(JSONObject arguments) {
        String relativeFilePath = arguments.getStr("relativeFilePath");
        return String.format("[å·¥å…·è°ƒç”¨] %s %s", getDisplayName(), relativeFilePath);
    }
}
```

	2. æ–‡ä»¶ç›®å½•è¯»å–å·¥å…·è¡¥å……ä»£ç ï¼š

```java
/**
 * æ–‡ä»¶ç›®å½•è¯»å–å·¥å…·
 * ä½¿ç”¨ Hutool ç®€åŒ–æ–‡ä»¶æ“ä½œ
 */
@Slf4j
@Component
public class FileDirReadTool extends BaseTool {
    
    // æ ¸å¿ƒæ–¹æ³•ä¸å˜ï¼Œæ­¤å¤„çœç•¥

    @Override
    public String getToolName() {
        return "readDir";
    }

    @Override
    public String getDisplayName() {
        return "è¯»å–ç›®å½•";
    }

    @Override
    public String generateToolExecutedResult(JSONObject arguments) {
        String relativeDirPath = arguments.getStr("relativeDirPath");
        if (StrUtil.isEmpty(relativeDirPath)) {
            relativeDirPath = "æ ¹ç›®å½•";
        }
        return String.format("[å·¥å…·è°ƒç”¨] %s %s", getDisplayName(), relativeDirPath);
    }
}
```

	3. æ–‡ä»¶ä¿®æ”¹å·¥å…·è¡¥å……ä»£ç 

```java
/**
 * æ–‡ä»¶ä¿®æ”¹å·¥å…·
 * æ”¯æŒ AI é€šè¿‡å·¥å…·è°ƒç”¨çš„æ–¹å¼ä¿®æ”¹æ–‡ä»¶å†…å®¹
 */
@Slf4j
@Component
public class FileModifyTool extends BaseTool {

    // æ ¸å¿ƒæ–¹æ³•ä¸å˜ï¼Œæ­¤å¤„çœç•¥
    
    @Override
    public String getToolName() {
        return "modifyFile";
    }

    @Override
    public String getDisplayName() {
        return "ä¿®æ”¹æ–‡ä»¶";
    }

    @Override
    public String generateToolExecutedResult(JSONObject arguments) {
        String relativeFilePath = arguments.getStr("relativeFilePath");
        String oldContent = arguments.getStr("oldContent");
        String newContent = arguments.getStr("newContent");
        // æ˜¾ç¤ºå¯¹æ¯”å†…å®¹
        return String.format("""
                [å·¥å…·è°ƒç”¨] %s %s
                
                æ›¿æ¢å‰ï¼š
                ```
                %s
                ```
                
                æ›¿æ¢åï¼š
                ```
                %s
                ```
                """, getDisplayName(), relativeFilePath, oldContent, newContent);
    }
}
```

	4. æ–‡ä»¶è¯»å–å·¥å…·è¡¥å……ä»£ç 

```java
/**
 * æ–‡ä»¶è¯»å–å·¥å…·
 * æ”¯æŒ AI é€šè¿‡å·¥å…·è°ƒç”¨çš„æ–¹å¼è¯»å–æ–‡ä»¶å†…å®¹
 */
@Slf4j
@Component
public class FileReadTool extends BaseTool {

    // æ ¸å¿ƒæ–¹æ³•ä¸å˜ï¼Œæ­¤å¤„çœç•¥

    @Override
    public String getToolName() {
        return "readFile";
    }

    @Override
    public String getDisplayName() {
        return "è¯»å–æ–‡ä»¶";
    }

    @Override
    public String generateToolExecutedResult(JSONObject arguments) {
        String relativeFilePath = arguments.getStr("relativeFilePath");
        return String.format("[å·¥å…·è°ƒç”¨] %s %s", getDisplayName(), relativeFilePath);
    }
}
```

	5. æ–‡ä»¶å†™å…¥å·¥å…·è¡¥å……ä»£ç 

```java
/**
 * æ–‡ä»¶å†™å…¥å·¥å…·
 * æ”¯æŒ AI é€šè¿‡å·¥å…·è°ƒç”¨çš„æ–¹å¼å†™å…¥æ–‡ä»¶
 */
@Slf4j
@Component
public class FileWriteTool extends BaseTool {

    // æ ¸å¿ƒæ–¹æ³•ä¸å˜ï¼Œæ­¤å¤„çœç•¥

    @Override
    public String getToolName() {
        return "writeFile";
    }

    @Override
    public String getDisplayName() {
        return "å†™å…¥æ–‡ä»¶";
    }

    @Override
    public String generateToolExecutedResult(JSONObject arguments) {
        String relativeFilePath = arguments.getStr("relativeFilePath");
        String suffix = FileUtil.getSuffix(relativeFilePath);
        String content = arguments.getStr("content");
        return String.format("""
                        [å·¥å…·è°ƒç”¨] %s %s
                        ```%s
                        %s
                        ```
                        """, getDisplayName(), relativeFilePath, suffix, content);
    }
}
```

3. å·¥å…·ç®¡ç†ç±»

ai.toolsåŒ…ä¸‹åˆ›å»ºå·¥å…·ç®¡ç†ç±»ï¼Œè‡ªåŠ¨æ³¨å†Œæ‰€æœ‰çš„å·¥å…·Bean,å¹¶ä¸”æä¾›äº†æ ¹æ®åç§°è·å–å·¥å…·çš„æ–¹æ³•ã€‚
æœ¬è´¨ä¸Šå°±æ˜¯ç»´æŠ¤ä¸€ä¸ªå·¥å…·Map,ä»£ç å¦‚ä¸‹ï¼š

```java
/**
 * å·¥å…·ç®¡ç†å™¨
 * ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å·¥å…·ï¼Œæä¾›æ ¹æ®åç§°è·å–å·¥å…·çš„åŠŸèƒ½
 */
@Slf4j
@Component
public class ToolManager {

    /**
     * å·¥å…·åç§°åˆ°å·¥å…·å®ä¾‹çš„æ˜ å°„
     */
    private final Map<String, BaseTool> toolMap = new HashMap<>();

    /**
     * è‡ªåŠ¨æ³¨å…¥æ‰€æœ‰å·¥å…·
     */
    @Resource
    private BaseTool[] tools;

    /**
     * åˆå§‹åŒ–å·¥å…·æ˜ å°„
     */
    @PostConstruct
    public void initTools() {
        for (BaseTool tool : tools) {
            toolMap.put(tool.getToolName(), tool);
            log.info("æ³¨å†Œå·¥å…·: {} -> {}", tool.getToolName(), tool.getDisplayName());
        }
        log.info("å·¥å…·ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆï¼Œå…±æ³¨å†Œ {} ä¸ªå·¥å…·", toolMap.size());
    }

    /**
     * æ ¹æ®å·¥å…·åç§°è·å–å·¥å…·å®ä¾‹
     *
     * @param toolName å·¥å…·è‹±æ–‡åç§°
     * @return å·¥å…·å®ä¾‹
     */
    public BaseTool getTool(String toolName) {
        return toolMap.get(toolName);
    }

    /**
     * è·å–å·²æ³¨å†Œçš„å·¥å…·é›†åˆ
     *
     * @return å·¥å…·å®ä¾‹é›†åˆ
     */
    public BaseTool[] getAllTools() {
        return tools;
    }
}
```

æ³¨æ„ï¼Œ**å¿…é¡»ä½¿ç”¨æ•°ç»„è‡ªåŠ¨æ³¨å…¥æ‰€æœ‰çš„å·¥å…·**ï¼Œè·å–æ‰€æœ‰å·¥å…·æ–¹æ³•(getAllTools)çš„è¿”å›å€¼å¿…é¡»æ˜¯æ•°ç»„è€Œä¸èƒ½æ˜¯é›†åˆï¼Œå¦åˆ™LangChain4çš„Al Serviceæ— æ³•æ­£ç¡®æ³¨å…¥å·¥å…·ï¼š

4. AIç»‘å®šå·¥å…·

ä¿®æ”¹AiCodeGeneratorServiceFactory,é€šè¿‡toolManageræ³¨å…¥æ‰€æœ‰å·¥å…·ï¼š

```java
@Resource
private ToolManager toolManager;

// Vue é¡¹ç›®ç”Ÿæˆä½¿ç”¨æ¨ç†æ¨¡å‹
case VUE_PROJECT -> AiServices.builder(AiCodeGeneratorService.class)
        .streamingChatModel(reasoningStreamingChatModel)
        .chatMemoryProvider(memoryId -> chatMemory)
        .tools(toolManager.getAllTools())
        .hallucinatedToolNameStrategy(toolExecutionRequest -> ToolExecutionResultMessage.from(
                toolExecutionRequest, "Error: there is no tool called " + toolExecutionRequest.name()
        ))
        .build();
```

5. ä¿®æ”¹æµå¤„ç†é€»è¾‘

æœ€åä¿®æ”¹æµå¤„ç†é€»è¾‘ï¼Œä»A!å“åº”ä¸­è·å–åˆ°æ‰§è¡Œçš„å·¥å…·åç§°ï¼Œç„¶åé€šè¿‡ToolManagerè·å–åˆ°å¯¹åº”çš„å·¥å…·å®ä¾‹ï¼Œå¹¶é€šè¿‡è°ƒç”¨æ–¹æ³•æ¥è¾“å‡ºä¿¡æ¯ã€‚ä»£ç éå¸¸ä¼˜é›…~ã€‚

```java
@Resource
private ToolManager toolManager;

case TOOL_REQUEST -> {
    ToolRequestMessage toolRequestMessage = JSONUtil.toBean(chunk, ToolRequestMessage.class);
    String toolId = toolRequestMessage.getId();
    String toolName = toolRequestMessage.getName();
    // æ£€æŸ¥æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªå·¥å…· ID
    if (toolId != null && !seenToolIds.contains(toolId)) {
        // ç¬¬ä¸€æ¬¡è°ƒç”¨è¿™ä¸ªå·¥å…·ï¼Œè®°å½• ID å¹¶è¿”å›å·¥å…·ä¿¡æ¯
        seenToolIds.add(toolId);
        // æ ¹æ®å·¥å…·åç§°è·å–å·¥å…·å®ä¾‹
        BaseTool tool = toolManager.getTool(toolName);
        // è¿”å›æ ¼å¼åŒ–çš„å·¥å…·è°ƒç”¨ä¿¡æ¯
        return tool.generateToolRequestResponse();
    } else {
        // ä¸æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨è¿™ä¸ªå·¥å…·ï¼Œç›´æ¥è¿”å›ç©º
        return "";
    }
}
case TOOL_EXECUTED -> {
    ToolExecutedMessage toolExecutedMessage = JSONUtil.toBean(chunk, ToolExecutedMessage.class);
    String toolName = toolExecutedMessage.getName();
    JSONObject jsonObject = JSONUtil.parseObj(toolExecutedMessage.getArguments());
    // æ ¹æ®å·¥å…·åç§°è·å–å·¥å…·å®ä¾‹å¹¶ç”Ÿæˆç›¸åº”çš„ç»“æœæ ¼å¼
    BaseTool tool = toolManager.getTool(toolName);
    String result = tool.generateToolExecutedResult(jsonObject);
    // è¾“å‡ºå‰ç«¯å’Œè¦æŒä¹…åŒ–çš„å†…å®¹
    String output = String.format("\n\n%s\n\n", result);
    chatHistoryStringBuilder.append(output);
    return output;
}
```

![image-20250810130817049](https://picbed-chengfu-1327906653.cos.ap-guangzhou.myqcloud.com/image/image-20250810130817049.webp)
